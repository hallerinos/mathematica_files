(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 13.1' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     33041,        857]
NotebookOptionsPosition[     31445,        830]
NotebookOutlinePosition[     31841,        846]
CellTagsIndexPosition[     31798,        843]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[{
 RowBox[{"Clear", "[", 
  RowBox[{"c", ",", "m"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"c", "=", "1"}], ";"}], 
  RowBox[{"(*", " ", 
   RowBox[{"sound", " ", "velocity"}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"m", "=", "2"}], ";"}], " ", 
  RowBox[{"(*", " ", "mass", " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{"Clear", "[", 
  RowBox[{"\[Lambda]", ",", "H0", ",", "u", ",", "upw", ",", "projs"}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"H0", "[", "p_", "]"}], ":=", 
   RowBox[{
    RowBox[{"c", " ", "p", " ", 
     RowBox[{"PauliMatrix", "[", "1", "]"}]}], "+", 
    RowBox[{"m", " ", 
     SuperscriptBox["c", "2"], " ", 
     RowBox[{"PauliMatrix", "[", "3", "]"}]}]}]}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{"Dirac", " ", "Hamiltonian"}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"u", "[", "p_", "]"}], ":=", 
   RowBox[{
    RowBox[{
     RowBox[{"Normalize", "[", "#", "]"}], "&"}], "/@", 
    RowBox[{"Eigenvectors", "[", 
     RowBox[{"H0", "[", "p", "]"}], "]"}]}]}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{"normalize", " ", "eigenvectors"}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"\[Lambda]", "[", "p_", "]"}], ":=", 
   RowBox[{"FullSimplify", "[", 
    RowBox[{
     RowBox[{"Diagonal", "[", 
      RowBox[{
       RowBox[{"u", "[", "p", "]"}], ".", 
       RowBox[{"H0", "[", "p", "]"}], ".", 
       RowBox[{"Inverse", "[", 
        RowBox[{"u", "[", "p", "]"}], "]"}]}], "]"}], "//", "ComplexExpand"}],
     "]"}]}], " ", 
  RowBox[{"(*", 
   RowBox[{"corresponding", " ", "eigenvalues"}], " ", "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"pw", "[", 
    RowBox[{"p_", ",", "x_", ",", "t_"}], "]"}], ":=", 
   RowBox[{
    RowBox[{
     RowBox[{
      FractionBox["1", 
       SqrtBox[
        RowBox[{"2", "\[Pi]"}]]], 
      RowBox[{"Exp", "[", 
       RowBox[{"\[ImaginaryI]", " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"p", " ", "x"}], "  ", "-", " ", 
          RowBox[{
           RowBox[{"#", "[", 
            RowBox[{"[", "1", "]"}], "]"}], " ", "t"}]}], ")"}]}], "]"}]}], 
     "&"}], "/@", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\[Lambda]", "[", "p", "]"}], ",", 
        RowBox[{"u", "[", "p", "]"}]}], "}"}], "\[Transpose]"}], ")"}]}]}], 
  " ", 
  RowBox[{"(*", " ", 
   RowBox[{"plane", " ", "waves"}], " ", "*)"}]}], "\n", 
 RowBox[{
  RowBox[{"projs", "[", "p_", "]"}], ":=", 
  RowBox[{"FullSimplify", "[", 
   RowBox[{"ComplexExpand", "[", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"PseudoInverse", "[", 
        RowBox[{"{", "v", "}"}], "]"}], ".", 
       RowBox[{"{", "v", "}"}]}], ",", 
      RowBox[{"{", 
       RowBox[{"v", ",", 
        RowBox[{"u", "[", "p", "]"}]}], "}"}]}], "]"}], "]"}], "]"}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{"projectors", " ", "on", " ", "the", " ", "eigenvectors"}], " ", 
   "*)"}]}]}], "Input",
 CellChangeTimes->{{3.8991996159676247`*^9, 3.8991997154587173`*^9}, {
   3.899199746885111*^9, 3.899199747625108*^9}, {3.899200052925282*^9, 
   3.8992000637946157`*^9}, {3.89920015124973*^9, 3.89920015352752*^9}, {
   3.899200255369989*^9, 3.899200278000442*^9}, {3.899200464926428*^9, 
   3.899200465755026*^9}, 3.899200528621524*^9, {3.899201316512802*^9, 
   3.899201332871187*^9}, {3.8992013749774446`*^9, 3.899201409151771*^9}, 
   3.899201572122171*^9, {3.899201604893835*^9, 3.899201613938159*^9}, {
   3.899201645415473*^9, 3.899201648588834*^9}, {3.8992019620074177`*^9, 
   3.899201962839456*^9}, {3.8992023108137903`*^9, 3.8992023159517603`*^9}, {
   3.899202793273018*^9, 3.899202814404142*^9}, {3.899203044556403*^9, 
   3.899203081883483*^9}, {3.899203340372406*^9, 3.899203344164381*^9}, {
   3.899203421219634*^9, 3.899203421282116*^9}, {3.899203552482148*^9, 
   3.899203552694132*^9}, {3.899203710039871*^9, 3.899203710233383*^9}, {
   3.899272011076633*^9, 3.899272012561125*^9}, {3.899272062692629*^9, 
   3.899272077016152*^9}, {3.899272108804015*^9, 3.8992721240679007`*^9}, {
   3.899272677119972*^9, 3.899272679627322*^9}, {3.8992728058352013`*^9, 
   3.899272818670018*^9}, {3.8992728600587683`*^9, 3.899272860088894*^9}, {
   3.899275347901998*^9, 3.899275348081786*^9}, {3.8992754889461184`*^9, 
   3.899275492392465*^9}, {3.8992755376331577`*^9, 3.899275557545045*^9}, {
   3.8992756372785387`*^9, 3.899275748646463*^9}, {3.899363898896452*^9, 
   3.899363900268833*^9}, {3.8993641786932983`*^9, 3.899364179336513*^9}, 
   3.899364468772708*^9, {3.89936465270289*^9, 3.899364652738805*^9}, {
   3.899364704478924*^9, 3.899364705602934*^9}, {3.8993647463936853`*^9, 
   3.8993647652677317`*^9}, {3.899365361628327*^9, 3.89936536171843*^9}, {
   3.89936653506419*^9, 3.899366548790146*^9}, {3.899366666344805*^9, 
   3.899366668846672*^9}, {3.899366738888668*^9, 3.8993668320981407`*^9}, {
   3.899367339699709*^9, 3.899367339817882*^9}, 3.899368015034544*^9, 
   3.89936819190283*^9, {3.900476543963909*^9, 3.900476544197867*^9}, {
   3.900476669470777*^9, 3.900476669547649*^9}, {3.900660470778984*^9, 
   3.900660525824394*^9}},
 CellLabel->
  "In[831]:=",ExpressionUUID->"dce17918-480b-402d-808f-1a586fc73b01"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"check", " ", "if", " ", "eigenvector"}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "*", 
           RowBox[{"#", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "-", 
          RowBox[{
           RowBox[{"H0", "[", "p", "]"}], ".", 
           RowBox[{"#", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}]}], ")"}], "&"}], "/@", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"\[Lambda]", "[", "p", "]"}], ",", 
           RowBox[{"u", "[", "p", "]"}]}], "}"}], "\[Transpose]"}], ")"}]}], "//",
       "ComplexExpand"}], "//", "FullSimplify"}], "//", "Chop"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "*", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "*", 
             RowBox[{"#", "[", 
              RowBox[{"[", "3", "]"}], "]"}]}], ")"}]}], "-", 
          RowBox[{
           RowBox[{"H0", "[", "p", "]"}], ".", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "*", 
             RowBox[{"#", "[", 
              RowBox[{"[", "3", "]"}], "]"}]}], ")"}]}]}], ")"}], "&"}], "/@", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"\[Lambda]", "[", "p", "]"}], ",", 
           RowBox[{"u", "[", "p", "]"}], ",", 
           RowBox[{"pw", "[", 
            RowBox[{"p", ",", "x", ",", "t"}], "]"}]}], "}"}], 
         "\[Transpose]"}], ")"}]}], "//", "ComplexExpand"}], "//", 
     "FullSimplify"}], "//", "Chop"}]}]}]], "Input",
 CellChangeTimes->{{3.899201617448141*^9, 3.8992017996065397`*^9}, {
  3.8992755114755163`*^9, 3.899275524678191*^9}, {3.899364488520164*^9, 
  3.8993645168566427`*^9}, {3.8993668350271387`*^9, 3.899366851949809*^9}, {
  3.8993673496781187`*^9, 3.899367349771473*^9}},
 CellLabel->
  "In[182]:=",ExpressionUUID->"742f31ed-ff1c-41d6-80fa-ef422a30ee2b"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"u", "[", "p", "]"}], ".", 
    RowBox[{"H0", "[", "p", "]"}], ".", 
    RowBox[{"PseudoInverse", "[", 
     RowBox[{"u", "[", "p", "]"}], "]"}]}], "//", "FullSimplify"}], "//", 
  "Chop"}]], "Input",
 CellChangeTimes->{{3.899200345153866*^9, 3.8992003953704*^9}, {
   3.899202333470416*^9, 3.899202333588402*^9}, 3.899364197392344*^9, {
   3.89936467315165*^9, 3.8993646951146812`*^9}},
 CellLabel->
  "In[184]:=",ExpressionUUID->"95b1a11c-89e8-4709-931e-5261a147ddf7"],

Cell[BoxData[{
 RowBox[{"Clear", "[", 
  RowBox[{"\[Psi]0", ",", "F", ",", "\[Sigma]"}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Sigma]", "=", "0.5"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Psi]0", "[", "x_", "]"}], ":=", 
  RowBox[{
   SuperscriptBox[
    RowBox[{"(", 
     FractionBox["1", 
      RowBox[{"8", 
       SuperscriptBox["\[Sigma]", "2"], " ", "\[Pi]"}]], ")"}], 
    RowBox[{"1", "/", "4"}]], 
   RowBox[{"Exp", "[", 
    RowBox[{
     RowBox[{"-", 
      SuperscriptBox["x", "2"]}], "/", 
     RowBox[{"(", 
      RowBox[{"4", 
       SuperscriptBox["\[Sigma]", "2"]}], ")"}]}], "]"}], 
   RowBox[{"{", 
    RowBox[{"1", ",", "1"}], "}"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"F", "[", 
   RowBox[{"f_", ",", "w_"}], "]"}], ":=", 
  RowBox[{"FourierTransform", "[", 
   RowBox[{
    RowBox[{"f", "[", "t", "]"}], ",", "t", ",", "w"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"F\[Psi]0", "[", "p_", "]"}], "=", 
  RowBox[{"F", "[", 
   RowBox[{"\[Psi]0", ",", "p"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"Clear", "[", "F\[Psi]0", "]"}], "\[IndentingNewLine]", 
     RowBox[{"F\[Psi]0", "[", "p_", "]"}]}], ":=", 
    RowBox[{
     RowBox[{"Exp", "[", 
      RowBox[{
       RowBox[{"-", "4"}], " ", 
       SuperscriptBox["p", "2"]}], "]"}], 
     SuperscriptBox[
      RowBox[{"(", 
       FractionBox["2", "\[Pi]"], ")"}], 
      RowBox[{"1", "/", "4"}]], 
     RowBox[{"{", 
      RowBox[{"1", ",", 
       RowBox[{"-", "1"}]}], "}"}]}]}], "*)"}]}]}], "Input",
 CellChangeTimes->{{3.8992005846449413`*^9, 3.8992006140857553`*^9}, {
   3.899200645355982*^9, 3.899200688092452*^9}, {3.899200775999446*^9, 
   3.899200806138298*^9}, {3.8992008390208483`*^9, 3.899200851388822*^9}, {
   3.899200919475506*^9, 3.8992009439841433`*^9}, {3.8992009824250507`*^9, 
   3.899200985298132*^9}, {3.8992014959792213`*^9, 3.899201547841401*^9}, {
   3.899203725511669*^9, 3.899203745279295*^9}, {3.8992037849589252`*^9, 
   3.899203857705928*^9}, {3.899274017526379*^9, 3.899274017581016*^9}, {
   3.899367876489464*^9, 3.8993679103291388`*^9}, {3.899367985185184*^9, 
   3.899367985513197*^9}, {3.8993680469959793`*^9, 3.8993680472539062`*^9}, {
   3.8993682239814262`*^9, 3.89936822402571*^9}, {3.899368280913957*^9, 
   3.8993682821310463`*^9}, {3.8993683572433167`*^9, 3.899368379170088*^9}, {
   3.9004771042231417`*^9, 3.900477110147676*^9}, 3.900660446227744*^9},
 CellLabel->
  "In[185]:=",ExpressionUUID->"a0de7918-8e18-41f4-b556-c0313e4e76b4"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"data0", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"x", ",", 
       SuperscriptBox[
        RowBox[{"Norm", "[", 
         RowBox[{"\[Psi]0", "[", "x", "]"}], "]"}], "2"]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"x", ",", 
       RowBox[{"-", "40"}], ",", "40", ",", "0.1"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"ListPlot", "[", 
  RowBox[{"data0", ",", 
   RowBox[{"PlotRange", "->", "Full"}], ",", 
   RowBox[{"Joined", "->", "True"}]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"Plot", "[", 
  RowBox[{
   SuperscriptBox[
    RowBox[{"Norm", "[", 
     RowBox[{"F\[Psi]0", "[", "p", "]"}], "]"}], "2"], ",", 
   RowBox[{"{", 
    RowBox[{"p", ",", 
     RowBox[{"-", "2"}], ",", "2"}], "}"}], ",", 
   RowBox[{"PlotRange", "->", "Full"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.899200616428691*^9, 3.8992006373500853`*^9}, {
  3.899200744181645*^9, 3.89920075261769*^9}, {3.899200792564794*^9, 
  3.899200826272922*^9}, {3.899200863822744*^9, 3.899200872740054*^9}, {
  3.899201015600544*^9, 3.899201040694119*^9}, {3.8992014688710127`*^9, 
  3.899201511168686*^9}, {3.899201554033145*^9, 3.899201555191771*^9}, {
  3.8992026752757998`*^9, 3.8992027130912457`*^9}, {3.899274903466695*^9, 
  3.899274905173439*^9}},
 CellLabel->
  "In[190]:=",ExpressionUUID->"6c193554-e3f9-4faf-87d5-c6d345de2190"],

Cell[BoxData[
 RowBox[{"F\[Psi]0", "[", "p", "]"}]], "Input",
 CellLabel->
  "In[193]:=",ExpressionUUID->"12b3d117-58b9-4100-8684-6c51b0e3f2fa"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"projs", "[", "p", "]"}], "[", 
    RowBox[{"[", "1", "]"}], "]"}], 
   RowBox[{
    RowBox[{"pw", "[", 
     RowBox[{"p", ",", "x", ",", "t"}], "]"}], "[", 
    RowBox[{"[", "1", "]"}], "]"}]}], "+", 
  RowBox[{
   RowBox[{
    RowBox[{"projs", "[", "p", "]"}], "[", 
    RowBox[{"[", "2", "]"}], "]"}], 
   RowBox[{
    RowBox[{"pw", "[", 
     RowBox[{"p", ",", "x", ",", "t"}], "]"}], "[", 
    RowBox[{"[", "2", "]"}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.8993642542874317`*^9, 3.899364273500472*^9}, {
  3.8993673697759047`*^9, 3.899367372174055*^9}},
 CellLabel->
  "In[194]:=",ExpressionUUID->"a3ed4e55-e8d0-43a3-8a5c-53add791fcab"],

Cell[BoxData[{
 RowBox[{"Clear", "[", "intarg", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"intarg", "[", 
   RowBox[{"p_", ",", "x_", ",", "t_"}], "]"}], "=", 
  RowBox[{"FullSimplify", "[", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"pw", "[", 
         RowBox[{"p", ",", "x", ",", "t"}], "]"}], "[", 
        RowBox[{"[", "1", "]"}], "]"}], "*", 
       RowBox[{
        RowBox[{"projs", "[", "p", "]"}], "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], "+", 
      RowBox[{
       RowBox[{
        RowBox[{"pw", "[", 
         RowBox[{"p", ",", "x", ",", "t"}], "]"}], "[", 
        RowBox[{"[", "2", "]"}], "]"}], "*", 
       RowBox[{
        RowBox[{"projs", "[", "p", "]"}], "[", 
        RowBox[{"[", "2", "]"}], "]"}]}]}], ")"}], ".", 
    RowBox[{"F\[Psi]0", "[", "p", "]"}]}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.899273238806163*^9, 3.899273276893915*^9}, {
   3.899273336654976*^9, 3.899273337223604*^9}, {3.899273404157045*^9, 
   3.8992734516885557`*^9}, {3.8992734952636642`*^9, 3.899273524674814*^9}, 
   3.8992736559258213`*^9, {3.8992738807546597`*^9, 3.8992739155043*^9}, {
   3.899273988768394*^9, 3.8992739971196747`*^9}, 3.899275762196727*^9, {
   3.899364394269331*^9, 3.89936440151628*^9}, {3.899364561212625*^9, 
   3.899364570934483*^9}, {3.899367375179298*^9, 3.899367379201968*^9}},
 CellLabel->
  "In[195]:=",ExpressionUUID->"bd3c09f5-0656-488d-bee7-eb37278e62da"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"nsteps", "=", "128"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"min", ",", "max"}], "}"}], "=", 
   RowBox[{"10", "\[Sigma]", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"-", "1"}], ",", "1"}], "}"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"xs", "=", 
   RowBox[{"Table", "[", 
    RowBox[{"x", ",", 
     RowBox[{"{", 
      RowBox[{"x", ",", "min", ",", "max", ",", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"max", "-", "min"}], ")"}], "/", 
        RowBox[{"(", 
         RowBox[{"nsteps", "-", "1"}], ")"}]}]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ts", "=", 
   RowBox[{"Table", "[", 
    RowBox[{"t", ",", 
     RowBox[{"{", 
      RowBox[{"t", ",", "0", ",", "max", ",", 
       RowBox[{"max", "/", 
        RowBox[{"(", 
         RowBox[{"nsteps", "-", "1"}], ")"}]}]}], "}"}]}], "]"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{"data", "=", 
   RowBox[{"ParallelTable", "[", 
    RowBox[{
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{"x", ",", "\[IndentingNewLine]", 
       SuperscriptBox[
        RowBox[{"Norm", "[", "\[IndentingNewLine]", 
         RowBox[{"Quiet", "[", "\[IndentingNewLine]", 
          RowBox[{"NIntegrate", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"intarg", "[", 
             RowBox[{"p", ",", "x", ",", "t"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"p", ",", 
              RowBox[{"-", "\[Infinity]"}], ",", "\[Infinity]"}], "}"}], 
            "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
            RowBox[{"Method", "->", 
             RowBox[{"{", 
              RowBox[{"Automatic", ",", 
               RowBox[{"\"\<SymbolicProcessing\>\"", "->", "0"}]}], "}"}]}]}],
            "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", "]"}], 
         "\[IndentingNewLine]", "]"}], "2"]}], "\[IndentingNewLine]", "}"}], 
     "\[IndentingNewLine]", ",", 
     RowBox[{"{", 
      RowBox[{"t", ",", "ts"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"x", ",", "xs"}], "}"}]}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.8993663102882347`*^9, 3.899366335324292*^9}, {
   3.899367001868063*^9, 3.899367268647666*^9}, {3.899367360793377*^9, 
   3.8993675512886963`*^9}, {3.899367627247921*^9, 3.89936762760984*^9}, {
   3.899367920880127*^9, 3.8993679602416162`*^9}, {3.899368034914542*^9, 
   3.89936807897409*^9}, {3.899368113339078*^9, 3.89936820239219*^9}, {
   3.8993682415391617`*^9, 3.89936824284507*^9}, 3.89936834041683*^9, {
   3.900664722615592*^9, 3.9006647227604113`*^9}, {3.900664949531013*^9, 
   3.900664955412773*^9}, {3.900665900527829*^9, 3.900665900884858*^9}, {
   3.9006659724941797`*^9, 3.900665977685115*^9}, {3.900666429068699*^9, 
   3.90066642929282*^9}},
 CellLabel->
  "In[1578]:=",ExpressionUUID->"d3a3e85c-34c4-4168-9442-decba905b257"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"cfun", "[", "x_", "]"}], ":=", 
  RowBox[{"Blend", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"White", ",", "Black"}], "}"}], ",", "x"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"plot", "=", 
   RowBox[{"Show", "[", 
    RowBox[{
     RowBox[{"ListDensityPlot", "[", 
      RowBox[{
       RowBox[{"data", "[", 
        RowBox[{"[", 
         RowBox[{";;", ",", ";;", ",", "2"}], "]"}], "]"}], ",", 
       RowBox[{"PlotRange", "->", "Full"}], ",", 
       RowBox[{"DataRange", "->", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"MinMax", "[", "xs", "]"}], ",", 
          RowBox[{"MinMax", "[", "ts", "]"}]}], "}"}]}], ",", 
       RowBox[{"PlotRangePadding", "->", "0"}], ",", 
       RowBox[{"PlotTheme", "->", "\"\<Scientific\>\""}], ",", 
       RowBox[{"ColorFunction", "->", "cfun"}]}], "]"}], ",", 
     RowBox[{"Plot", "[", 
      RowBox[{
       RowBox[{"c", "*", "x", 
        RowBox[{"{", 
         RowBox[{"1", ",", 
          RowBox[{"-", "1"}]}], "}"}]}], ",", 
       RowBox[{"{", 
        RowBox[{"x", ",", 
         RowBox[{"Sequence", "@@", 
          RowBox[{"MinMax", "[", "xs", "]"}]}]}], "}"}], ",", 
       RowBox[{"PlotStyle", "->", 
        RowBox[{"{", 
         RowBox[{"Dashed", ",", "Black"}], "}"}]}]}], "]"}]}], "]"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{"meanPosition", "=", 
   RowBox[{"ListPlot", "[", 
    RowBox[{
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{"xs", ".", 
           RowBox[{"data", "[", 
            RowBox[{"[", 
             RowBox[{"ti", ",", ";;", ",", "2"}], "]"}], "]"}]}], "/", 
          RowBox[{"Total", "[", 
           RowBox[{"data", "[", 
            RowBox[{"[", 
             RowBox[{"ti", ",", ";;", ",", "2"}], "]"}], "]"}], "]"}]}], ",", 
         
         RowBox[{"ts", "[", 
          RowBox[{"[", "ti", "]"}], "]"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"ti", ",", 
         RowBox[{"Length", "[", "data", "]"}]}], "}"}]}], "]"}], ",", 
     RowBox[{"Joined", "->", "True"}], ",", 
     RowBox[{"PlotTheme", "->", "\"\<Scientific\>\""}]}], "]"}]}], 
  ";"}], "\n", 
 RowBox[{"Show", "[", 
  RowBox[{"plot", ",", "meanPosition"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ListPlot", "[", 
   RowBox[{
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"ts", "[", 
         RowBox[{"[", "ti", "]"}], "]"}], ",", 
        RowBox[{
         FractionBox["1", 
          SuperscriptBox["\[Sigma]", "2"]], 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"xs", "^", "2"}], ")"}], ".", 
           RowBox[{"data", "[", 
            RowBox[{"[", 
             RowBox[{"ti", ",", ";;", ",", "2"}], "]"}], "]"}]}], "/", 
          RowBox[{"Total", "[", 
           RowBox[{"data", "[", 
            RowBox[{"[", 
             RowBox[{"ti", ",", ";;", ",", "2"}], "]"}], "]"}], "]"}]}]}]}], 
       "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"ti", ",", 
        RowBox[{"Length", "[", "data", "]"}]}], "}"}]}], "]"}], ",", 
    RowBox[{"Joined", "->", "True"}], ",", 
    RowBox[{"PlotTheme", "->", "\"\<Scientific\>\""}]}], "]"}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.8993663102882347`*^9, 3.899366335324292*^9}, {
   3.899367001868063*^9, 3.899367268647666*^9}, {3.899367360793377*^9, 
   3.8993675512886963`*^9}, {3.899367627247921*^9, 3.89936762760984*^9}, {
   3.899367920880127*^9, 3.8993679602416162`*^9}, {3.899368034914542*^9, 
   3.89936807897409*^9}, {3.899368113339078*^9, 3.89936820239219*^9}, {
   3.8993682415391617`*^9, 3.89936824284507*^9}, 3.89936834041683*^9, 
   3.9006662185227127`*^9},
 CellLabel->
  "In[1583]:=",ExpressionUUID->"7d8b276d-3fb9-4000-bd89-076ef36ce9f1"],

Cell[BoxData[
 RowBox[{
  RowBox[{"data", "[", 
   RowBox[{"[", 
    RowBox[{"1", ",", ";;", ",", "2"}], "]"}], "]"}], "//", 
  "ListPlot"}]], "Input",
 CellChangeTimes->{{3.900666226563986*^9, 3.900666229503541*^9}},
 CellLabel->
  "In[1588]:=",ExpressionUUID->"9f72d850-f9d3-4aee-ae75-06be981509ec"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"nsteps", "=", "128"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"min", ",", "max"}], "}"}], "=", 
   RowBox[{"40", "\[Sigma]", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"-", "1"}], ",", "1"}], "}"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"xs", "=", 
   RowBox[{"Table", "[", 
    RowBox[{"x", ",", 
     RowBox[{"{", 
      RowBox[{"x", ",", "min", ",", "max", ",", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"max", "-", "min"}], ")"}], "/", 
        RowBox[{"(", 
         RowBox[{"nsteps", "-", "1"}], ")"}]}]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[CapitalDelta]x", "=", 
   RowBox[{
    RowBox[{"xs", "[", 
     RowBox[{"[", "2", "]"}], "]"}], "-", 
    RowBox[{"xs", "[", 
     RowBox[{"[", "1", "]"}], "]"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[CapitalDelta]t", "=", "0.001"}], ";", 
  RowBox[{"m", "=", "0"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"Clear", "[", "\[Psi]", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Psi]", "=", 
   RowBox[{"{", "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"AppendTo", "[", 
   RowBox[{"\[Psi]", ",", 
    RowBox[{
     RowBox[{
      RowBox[{"\[Psi]0", "[", "#", "]"}], "&"}], "/@", "xs"}]}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Do", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"\[Psi]prev", " ", "=", " ", 
      RowBox[{"\[Psi]", "[", 
       RowBox[{"[", 
        RowBox[{"-", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"\[Psi]next", "=", 
      RowBox[{"0", "*", "\[Psi]prev"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Do", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"\[Psi]next", "[", 
          RowBox[{"[", "n", "]"}], "]"}], "=", 
         RowBox[{
          RowBox[{"\[Psi]prev", "[", 
           RowBox[{"[", "n", "]"}], "]"}], "-", 
          RowBox[{"\[CapitalDelta]t", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"c", " ", 
               RowBox[{"PauliMatrix", "[", "1", "]"}]}], "+", 
              RowBox[{"m", " ", 
               SuperscriptBox["c", "2"], " ", 
               RowBox[{"PauliMatrix", "[", "3", "]"}]}]}], ")"}], ".", 
            FractionBox[
             RowBox[{
              RowBox[{"\[Psi]prev", "[", 
               RowBox[{"[", 
                RowBox[{
                 RowBox[{"Mod", "[", 
                  RowBox[{
                   RowBox[{"n", "+", "1"}], ",", 
                   RowBox[{"Length", "[", "xs", "]"}]}], "]"}], "+", "1"}], 
                "]"}], "]"}], "-", 
              RowBox[{"\[Psi]prev", "[", 
               RowBox[{"[", "n", "]"}], "]"}]}], "\[CapitalDelta]x"]}]}]}]}], 
        ";"}], ",", 
       RowBox[{"{", 
        RowBox[{"n", ",", 
         RowBox[{"Length", "[", "xs", "]"}]}], "}"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"\[Psi]next", "=", 
      RowBox[{
       RowBox[{"\[Psi]next", "/", 
        RowBox[{"Norm", "[", "\[Psi]next", "]"}]}], "*", 
       RowBox[{"Norm", "[", "\[Psi]prev", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"AppendTo", "[", 
      RowBox[{"\[Psi]", ",", "\[Psi]next"}], "]"}], ";"}], 
    "\[IndentingNewLine]", ",", 
    RowBox[{"{", 
     RowBox[{"t", ",", "100"}], "}"}]}], "]"}], ";"}]}], "Input",
 CellChangeTimes->{{3.900663555889638*^9, 3.900663731329278*^9}, {
   3.9006640797399797`*^9, 3.900664130770805*^9}, {3.900664181534184*^9, 
   3.900664188070108*^9}, {3.900664223864684*^9, 3.900664262321631*^9}, {
   3.9006642946952343`*^9, 3.900664695880342*^9}, {3.90066477130661*^9, 
   3.900664837303337*^9}, {3.900665077004554*^9, 3.9006652923775578`*^9}, {
   3.900665411557876*^9, 3.90066541431752*^9}, 3.900665451158965*^9, {
   3.900665494721993*^9, 3.900665669632245*^9}, {3.900665699845585*^9, 
   3.9006658389946833`*^9}, {3.900665873377214*^9, 3.9006658830688887`*^9}, {
   3.900665926621874*^9, 3.900665964423295*^9}, {3.900666001620859*^9, 
   3.900666092790495*^9}, {3.900666147405439*^9, 3.90066620455974*^9}, {
   3.9006662385962477`*^9, 3.900666257871393*^9}, {3.900666294740869*^9, 
   3.9006664150038223`*^9}, {3.900666453475819*^9, 3.900666475546527*^9}, {
   3.900666535484088*^9, 3.90066654018919*^9}, {3.900668834116276*^9, 
   3.9006688385361433`*^9}, {3.900668872430005*^9, 3.9006688727218447`*^9}},
 CellLabel->
  "In[1982]:=",ExpressionUUID->"b042111d-0b26-4f8e-8877-8ee38affdf75"],

Cell[BoxData[
 RowBox[{
  RowBox[{"S", "=", 
   RowBox[{
    RowBox[{"SparseArray", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"Band", "[", 
          RowBox[{"{", 
           RowBox[{"1", ",", "1"}], "}"}], "]"}], "\[Rule]", 
         RowBox[{"-", "2"}]}], ",", 
        RowBox[{
         RowBox[{"Band", "[", 
          RowBox[{"{", 
           RowBox[{"2", ",", "1"}], "}"}], "]"}], "\[Rule]", "1"}], ",", 
        RowBox[{
         RowBox[{"Band", "[", 
          RowBox[{"{", 
           RowBox[{"1", ",", "2"}], "}"}], "]"}], "\[Rule]", "1"}]}], "}"}], 
      ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Length", "[", "xs", "]"}], ",", 
        RowBox[{"Length", "[", "xs", "]"}]}], "}"}]}], "]"}], "/", 
    SuperscriptBox["\[CapitalDelta]x", "2"]}]}], ";"}]], "Input",
 CellChangeTimes->{{3.900668429809001*^9, 3.900668474254257*^9}, {
  3.9006685177573357`*^9, 3.900668549853897*^9}, {3.900668633740654*^9, 
  3.9006686453435507`*^9}},
 CellLabel->
  "In[1991]:=",ExpressionUUID->"a5b8318b-95ea-4084-ba4f-84c9d3978f51"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"\[CapitalDelta]x", "=", 
   RowBox[{
    RowBox[{"xs", "[", 
     RowBox[{"[", "2", "]"}], "]"}], "-", 
    RowBox[{"xs", "[", 
     RowBox[{"[", "1", "]"}], "]"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[CapitalDelta]t", "=", "0.01"}], ";", 
  RowBox[{"m", "=", "0"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"Clear", "[", "\[Psi]", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Psi]", "=", 
   RowBox[{"{", "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"AppendTo", "[", 
   RowBox[{"\[Psi]", ",", 
    RowBox[{"Normalize", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Max", "[", 
        RowBox[{
         SuperscriptBox["10", 
          RowBox[{"-", "16"}]], ",", 
         RowBox[{
          RowBox[{"\[Psi]0", "[", "#", "]"}], "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "&"}], "/@", "xs"}], 
     "]"}]}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Do", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"\[Psi]prev", " ", "=", " ", 
      RowBox[{"\[Psi]", "[", 
       RowBox[{"[", 
        RowBox[{"-", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"\[Psi]next", "=", 
      RowBox[{"0", "*", "\[Psi]prev"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"\[Psi]next", "=", 
      RowBox[{"\[Psi]prev", "+", " ", 
       RowBox[{"\[CapitalDelta]t", " ", 
        RowBox[{"S", ".", "\[Psi]prev"}]}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"\[Psi]next", "=", 
      RowBox[{
       RowBox[{"\[Psi]next", "/", 
        RowBox[{"Norm", "[", "\[Psi]next", "]"}]}], "*", 
       RowBox[{"Norm", "[", "\[Psi]prev", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"AppendTo", "[", 
      RowBox[{"\[Psi]", ",", "\[Psi]next"}], "]"}], ";"}], 
    "\[IndentingNewLine]", ",", 
    RowBox[{"{", 
     RowBox[{"t", ",", "4000"}], "}"}]}], "]"}], ";"}], "\n", 
 RowBox[{"ListPlot", "[", 
  RowBox[{
   RowBox[{
    RowBox[{
     SuperscriptBox[
      RowBox[{"Abs", "[", "#", "]"}], "2"], "&"}], "/@", "\[Psi]"}], ",", 
   RowBox[{"PlotRange", "->", "Full"}], ",", 
   RowBox[{"Joined", "->", "True"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.900663555889638*^9, 3.900663731329278*^9}, {
   3.9006640797399797`*^9, 3.900664130770805*^9}, {3.900664181534184*^9, 
   3.900664188070108*^9}, {3.900664223864684*^9, 3.900664262321631*^9}, {
   3.9006642946952343`*^9, 3.900664695880342*^9}, {3.90066477130661*^9, 
   3.900664837303337*^9}, {3.900665077004554*^9, 3.9006652923775578`*^9}, {
   3.900665411557876*^9, 3.90066541431752*^9}, 3.900665451158965*^9, {
   3.900665494721993*^9, 3.900665669632245*^9}, {3.900665699845585*^9, 
   3.9006658389946833`*^9}, {3.900665873377214*^9, 3.9006658830688887`*^9}, {
   3.900665926621874*^9, 3.900665964423295*^9}, {3.900666001620859*^9, 
   3.900666092790495*^9}, {3.900666147405439*^9, 3.90066620455974*^9}, {
   3.9006662385962477`*^9, 3.900666257871393*^9}, {3.900666294740869*^9, 
   3.9006664150038223`*^9}, {3.900666453475819*^9, 3.900666475546527*^9}, {
   3.900666535484088*^9, 3.90066654018919*^9}, {3.900667322834754*^9, 
   3.900667373055719*^9}, {3.900668153466545*^9, 3.900668196660118*^9}, {
   3.900668274433117*^9, 3.900668276235836*^9}, {3.900668334572541*^9, 
   3.900668418935457*^9}, {3.900668555975416*^9, 3.9006686167555304`*^9}, {
   3.9006686584298773`*^9, 3.9006687204646387`*^9}, {3.900668762262238*^9, 
   3.900668815706896*^9}, {3.900668846620796*^9, 3.900668866601768*^9}, {
   3.900668900681823*^9, 3.900668999681416*^9}},
 CellLabel->
  "In[2083]:=",ExpressionUUID->"b615b97f-7b7b-437b-82e0-0d0858f98c99"]
},
WindowSize->{960, 1027},
WindowMargins->{{Automatic, 0}, {Automatic, 0}},
FrontEndVersion->"13.2 for Mac OS X ARM (64-bit) (November 18, 2022)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"c40823df-d9d3-46ff-bbfd-84452633e3f4"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 5299, 127, 226, "Input",ExpressionUUID->"dce17918-480b-402d-808f-1a586fc73b01"],
Cell[5860, 149, 2411, 69, 73, "Input",ExpressionUUID->"742f31ed-ff1c-41d6-80fa-ef422a30ee2b"],
Cell[8274, 220, 529, 13, 30, "Input",ExpressionUUID->"95b1a11c-89e8-4709-931e-5261a147ddf7"],
Cell[8806, 235, 2580, 66, 188, "Input",ExpressionUUID->"a0de7918-8e18-41f4-b556-c0313e4e76b4"],
Cell[11389, 303, 1407, 35, 77, "Input",ExpressionUUID->"6c193554-e3f9-4faf-87d5-c6d345de2190"],
Cell[12799, 340, 144, 3, 30, "Input",ExpressionUUID->"12b3d117-58b9-4100-8684-6c51b0e3f2fa"],
Cell[12946, 345, 705, 21, 30, "Input",ExpressionUUID->"a3ed4e55-e8d0-43a3-8a5c-53add791fcab"],
Cell[13654, 368, 1456, 34, 52, "Input",ExpressionUUID->"bd3c09f5-0656-488d-bee7-eb37278e62da"],
Cell[15113, 404, 2921, 72, 373, "Input",ExpressionUUID->"d3a3e85c-34c4-4168-9442-decba905b257"],
Cell[18037, 478, 3815, 106, 227, "Input",ExpressionUUID->"7d8b276d-3fb9-4000-bd89-076ef36ce9f1"],
Cell[21855, 586, 301, 8, 30, "Input",ExpressionUUID->"9f72d850-f9d3-4aee-ae75-06be981509ec"],
Cell[22159, 596, 4549, 115, 414, "Input",ExpressionUUID->"b042111d-0b26-4f8e-8877-8ee38affdf75"],
Cell[26711, 713, 1090, 31, 33, "Input",ExpressionUUID->"a5b8318b-95ea-4084-ba4f-84c9d3978f51"],
Cell[27804, 746, 3637, 82, 287, "Input",ExpressionUUID->"b615b97f-7b7b-437b-82e0-0d0858f98c99"]
}
]
*)

