(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 12.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    100796,       2409]
NotebookOptionsPosition[     98977,       2375]
NotebookOutlinePosition[     99497,       2394]
CellTagsIndexPosition[     99454,       2391]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Create Graphene Sheet", "Section",
 CellChangeTimes->{{3.861338402462072*^9, 3.861338407262868*^9}, {
  3.8623720551807947`*^9, 3.8623720605574217`*^9}, {3.862469916867041*^9, 
  3.8624699403000813`*^9}},ExpressionUUID->"3f90875f-d181-4cb6-a0d4-\
c5d25785af38"],

Cell[BoxData[{
 RowBox[{"<<", "MaTeX`"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"a", "=", "0.142"}], ";", " ", 
   RowBox[{"dunit", "=", "\"\<\\\\ [{\\\\rm nm}]\>\""}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"a", "=", "1.0"}], ";", 
    RowBox[{"dunit", "=", "\"\</d_0\>\""}], ";"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"inFrac", "=", "0.5"}], ";"}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"fraction", " ", "of", " ", "in"}], "-", 
    RowBox[{"scattering", " ", "region"}]}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"nuc", "=", "31"}], ";", " ", 
   RowBox[{"(*", " ", 
    RowBox[{
    "number", " ", "of", " ", "unit", " ", "cells", " ", "in", " ", "the", 
     " ", "final", " ", "region"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{"width", "=", 
    RowBox[{"3", "*", "nuc", " ", "a"}]}], ";", " ", 
   RowBox[{"(*", " ", 
    RowBox[{
    "upscaled", " ", "width", " ", "and", " ", "heigth", " ", "to", " ", 
     "match", " ", 
     RowBox[{"nuc", "\[Cross]", "nuc"}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"height", "=", "width"}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"nuc", "=", "11"}], ";", "\[IndentingNewLine]", 
    RowBox[{"width", "=", 
     RowBox[{"3", " ", "nuc", " ", "a"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"height", "=", 
     RowBox[{"1.1", "*", "width"}]}], ";"}], "*)"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"L", "=", 
   RowBox[{"Max", "[", 
    RowBox[{"{", 
     RowBox[{"width", ",", "height"}], "}"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"L1", "=", 
   FractionBox[
    RowBox[{"L", "+", "a"}], "a"]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"L2", "=", 
    FractionBox[
     RowBox[{"L", "+", "a"}], "a"]}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{"primitive", " ", "lattice", " ", "vectors"}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"a1", "=", 
   RowBox[{
    FractionBox["a", "2"], 
    RowBox[{"{", 
     RowBox[{"3", ",", 
      SqrtBox["3"], ",", "0"}], "}"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"a2", "=", 
   RowBox[{
    FractionBox["a", "2"], 
    RowBox[{"{", 
     RowBox[{"3", ",", 
      RowBox[{"-", 
       SqrtBox["3"]}], ",", "0"}], "}"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"b1", "=", 
   RowBox[{"{", 
    RowBox[{"a", ",", "0", ",", "0"}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"uc", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"0", "*", "b1"}], ",", "b1"}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ss", " ", "=", " ", 
   RowBox[{"0.3", "a"}]}], ";", 
  RowBox[{"ts", "=", 
   RowBox[{"0.1", "a"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"latt", "=", 
   RowBox[{"Flatten", "[", 
    RowBox[{
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{"n1", "*", "a1"}], "+", 
          RowBox[{"n2", "*", "a2"}], "+", 
          RowBox[{"uc", "[", 
           RowBox[{"[", "i", "]"}], "]"}]}], ",", "i"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"n1", ",", "L1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"n2", ",", "L2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", 
         RowBox[{"Length", "[", "uc", "]"}]}], "}"}]}], "]"}], ",", "2"}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"meanPosition", "=", 
   RowBox[{"Mean", "[", 
    RowBox[{"latt", "[", 
     RowBox[{"[", 
      RowBox[{"All", ",", "1"}], "]"}], "]"}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"latt", "[", 
    RowBox[{"[", 
     RowBox[{"All", ",", "1"}], "]"}], "]"}], "=", 
   RowBox[{
    RowBox[{
     RowBox[{"(", 
      RowBox[{"#", "-", "meanPosition"}], ")"}], "&"}], "/@", 
    RowBox[{"latt", "[", 
     RowBox[{"[", 
      RowBox[{"All", ",", "1"}], "]"}], "]"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"lattRegion", "=", 
    RowBox[{"DeleteCases", "[", 
     RowBox[{"latt", ",", 
      RowBox[{"_", "?", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"Not", "[", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"-", "width"}], "/", "2"}], "<", 
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "1"}], "]"}], "]"}], "<", 
             RowBox[{"width", "/", "2"}]}], ")"}], "&&", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"-", "height"}], "/", "2"}], "<", 
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "2"}], "]"}], "]"}], "<", 
             RowBox[{
              RowBox[{"(", "height", ")"}], "/", "2"}]}], ")"}]}], "]"}], 
         "&"}], ")"}]}]}], "]"}]}], ";"}], "\[IndentingNewLine]"}], "\n", 
 RowBox[{
  RowBox[{"rB", "=", 
   RowBox[{"Max", "[", 
    RowBox[{
     RowBox[{"lattRegion", "[", 
      RowBox[{"[", 
       RowBox[{"All", ",", "1"}], "]"}], "]"}], "[", 
     RowBox[{"[", 
      RowBox[{"All", ",", "1"}], "]"}], "]"}], "]"}]}], ";", 
  RowBox[{"lB", "=", 
   RowBox[{"Min", "[", 
    RowBox[{
     RowBox[{"lattRegion", "[", 
      RowBox[{"[", 
       RowBox[{"All", ",", "1"}], "]"}], "]"}], "[", 
     RowBox[{"[", 
      RowBox[{"All", ",", "1"}], "]"}], "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"tB", "=", 
   RowBox[{"Max", "[", 
    RowBox[{
     RowBox[{"lattRegion", "[", 
      RowBox[{"[", 
       RowBox[{"All", ",", "1"}], "]"}], "]"}], "[", 
     RowBox[{"[", 
      RowBox[{"All", ",", "2"}], "]"}], "]"}], "]"}]}], ";", 
  RowBox[{"bB", "=", 
   RowBox[{"Min", "[", 
    RowBox[{
     RowBox[{"lattRegion", "[", 
      RowBox[{"[", 
       RowBox[{"All", ",", "1"}], "]"}], "]"}], "[", 
     RowBox[{"[", 
      RowBox[{"All", ",", "2"}], "]"}], "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"lrPos", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"Flatten", "[", 
      RowBox[{"Position", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"lattRegion", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "1"}], "]"}], "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", 
        RowBox[{"n_", " ", "/;", " ", 
         RowBox[{"n", "\[Equal]", "#"}]}]}], "]"}], "]"}], "&"}], "/@", 
    RowBox[{"{", 
     RowBox[{"rB", ",", "lB"}], "}"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"tbPos", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"Flatten", "[", 
      RowBox[{"Position", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"lattRegion", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "1"}], "]"}], "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "2"}], "]"}], "]"}], ",", 
        RowBox[{"n_", " ", "/;", " ", 
         RowBox[{"n", "\[Equal]", "#"}]}]}], "]"}], "]"}], "&"}], "/@", 
    RowBox[{"{", 
     RowBox[{"tB", ",", "bB"}], "}"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"bPos", "=", 
    RowBox[{"Join", "[", 
     RowBox[{"lrPos", ",", "tbPos"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"cL", "=", 
   RowBox[{"IntegerPart", "[", 
    RowBox[{
     RowBox[{"Length", "[", 
      RowBox[{"tbPos", "[", 
       RowBox[{"[", "2", "]"}], "]"}], "]"}], "/", "2"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"inR", " ", "=", " ", 
   RowBox[{"IntegerPart", "[", 
    RowBox[{"cL", "*", "inFrac"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"inPos", " ", "=", " ", 
   RowBox[{"tbPos", "[", 
    RowBox[{"[", 
     RowBox[{"2", ",", 
      RowBox[{
       RowBox[{"cL", "-", "inR", "+", "1"}], ";;", 
       RowBox[{"-", 
        RowBox[{"(", 
         RowBox[{"cL", "-", "inR", "+", "1"}], ")"}]}]}]}], "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"bPos", "=", 
    RowBox[{
     RowBox[{
      RowBox[{"Complement", "[", 
       RowBox[{"#", ",", "inPos"}], "]"}], "&"}], "/@", "bPos"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"lattCols", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Darker", "[", "Gray", "]"}], ",", 
     RowBox[{"Lighter", "[", "Gray", "]"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"boundaryCols", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Darker", "[", "Green", "]"}], ",", 
     RowBox[{"Lighter", "[", "Green", "]"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"injectionCols", "=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"Darker", "[", "Blue", "]"}], ",", 
      RowBox[{"Lighter", "[", "Blue", "]"}]}], "}"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"latt", "=", 
   RowBox[{"Chop", "[", "lattRegion", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"latt", "[", 
    RowBox[{"[", 
     RowBox[{"All", ",", "1"}], "]"}], "]"}], "=", 
   RowBox[{
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{"#", "[", 
        RowBox[{"[", "1", "]"}], "]"}], "-", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Min", "[", 
          RowBox[{"latt", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", "1", ",", "1"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"Min", "[", 
          RowBox[{"latt", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", "1", ",", "2"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"Min", "[", 
          RowBox[{"latt", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", "1", ",", "3"}], "]"}], "]"}], "]"}]}], 
        "}"}]}], ")"}], "&"}], "/@", "latt"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"lattBR", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"latt", "[", 
      RowBox[{"[", "#", "]"}], "]"}], "&"}], "/@", 
    RowBox[{"Flatten", "[", "bPos", "]"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"lattIN", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"latt", "[", 
      RowBox[{"[", "#", "]"}], "]"}], "&"}], "/@", 
    RowBox[{"Flatten", "[", "inPos", "]"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"dimH", " ", "=", " ", 
   RowBox[{"Length", "[", "latt", "]"}]}], ";"}], "\n", 
 RowBox[{"Clear", "[", "lattRegions", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Evaluate", "[", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{"lattRegions", "[", "i", "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"i", ",", 
        RowBox[{"Length", "[", "uc", "]"}]}], "}"}]}], "]"}], "]"}], "=", 
   RowBox[{"Evaluate", "[", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{"DeleteCases", "[", 
       RowBox[{"latt", ",", 
        RowBox[{"_", "?", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Not", "[", 
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "\[Equal]", "i"}], "]"}], "&"}],
           ")"}]}]}], "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"i", ",", 
        RowBox[{"Length", "[", "uc", "]"}]}], "}"}]}], "]"}], "]"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{"lattPlot", "=", 
   RowBox[{"Graphics3D", "[", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"lattCols", "[", 
           RowBox[{"[", 
            RowBox[{"#", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], ",", 
          RowBox[{"Sphere", "[", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", "ss"}], "]"}]}], "}"}], 
        "&"}], "/@", 
       RowBox[{"lattRegions", "[", "i", "]"}]}], ",", 
      RowBox[{"{", 
       RowBox[{"i", ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "2"}], "}"}]}], "}"}]}], "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"boundaryPlot", "=", 
   RowBox[{"Graphics3D", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"boundaryCols", "[", 
         RowBox[{"[", 
          RowBox[{"#", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], ",", 
        RowBox[{"Sphere", "[", 
         RowBox[{
          RowBox[{"#", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", "ss"}], "]"}]}], "}"}], "&"}],
      "/@", "lattBR"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"injectionPlot", "=", 
   RowBox[{"Graphics3D", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"injectionCols", "[", 
         RowBox[{"[", 
          RowBox[{"#", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], ",", 
        RowBox[{"Sphere", "[", 
         RowBox[{
          RowBox[{"#", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", "ss"}], "]"}]}], "}"}], "&"}],
      "/@", "lattIN"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"nodesPlot", "=", 
   RowBox[{"Show", "[", 
    RowBox[{"lattPlot", ",", "boundaryPlot", ",", "injectionPlot", ",", 
     RowBox[{"ViewPoint", "\[Rule]", "Top"}], ",", 
     RowBox[{"Axes", "\[Rule]", "True"}], ",", 
     RowBox[{"AxesLabel", "\[Rule]", 
      RowBox[{"MaTeX", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"#", "<>", "dunit"}], "&"}], "/@", 
        RowBox[{"{", 
         RowBox[{"\"\<x\>\"", ",", "\"\<y\>\"", ",", "\"\<z\>\""}], "}"}]}], 
       "]"}]}]}], "]"}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"dist", "[", 
    RowBox[{"n1_", ",", "n2_"}], "]"}], ":=", 
   RowBox[{"Norm", "[", 
    RowBox[{"n2", "-", "n1"}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"dists", "=", 
   RowBox[{"Outer", "[", 
    RowBox[{"dist", ",", 
     RowBox[{"latt", "[", 
      RowBox[{"[", 
       RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", 
     RowBox[{"latt", "[", 
      RowBox[{"[", 
       RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", "1"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ddists", "=", 
   RowBox[{
    RowBox[{"DeleteDuplicates", "[", 
     RowBox[{"Chop", "[", 
      RowBox[{"dists", "//", "Flatten"}], "]"}], "]"}], "//", "Sort"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{"neighbors", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"Position", "[", 
      RowBox[{"dists", ",", 
       RowBox[{"x_", "/;", 
        RowBox[{
         RowBox[{"Abs", "[", 
          RowBox[{"x", "-", "#"}], "]"}], "<", "1*^-8"}]}], ",", "3"}], "]"}],
      "&"}], "/@", 
    RowBox[{"ddists", "[", 
     RowBox[{"[", 
      RowBox[{";;", "2"}], "]"}], "]"}]}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"nnPlot", "=", 
   RowBox[{"Graphics3D", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Black", ",", 
          RowBox[{"CapForm", "[", "\"\<Butt\>\"", "]"}], ",", 
          RowBox[{"Tube", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"latt", "[", 
               RowBox[{"[", 
                RowBox[{
                 RowBox[{"#", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], ",", "1"}], "]"}], "]"}], 
              ",", 
              RowBox[{"latt", "[", 
               RowBox[{"[", 
                RowBox[{
                 RowBox[{"#", "[", 
                  RowBox[{"[", "2", "]"}], "]"}], ",", "1"}], "]"}], "]"}]}], 
             "}"}], ",", "ts"}], "]"}]}], "}"}], "&"}], "/@", 
       RowBox[{"neighbors", "[", 
        RowBox[{"[", "2", "]"}], "]"}]}], "}"}], ",", 
     RowBox[{"ViewPoint", "\[Rule]", "Top"}]}], "]"}]}], ";"}], "\n", 
 RowBox[{"Show", "[", 
  RowBox[{"nodesPlot", ",", "nnPlot", ",", 
   RowBox[{"ViewPoint", "\[Rule]", "Top"}], ",", 
   RowBox[{"Axes", "\[Rule]", "True"}], ",", 
   RowBox[{"AxesLabel", "\[Rule]", 
    RowBox[{"MaTeX", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"#", "<>", "dunit"}], "&"}], "/@", 
      RowBox[{"{", 
       RowBox[{"\"\<x\>\"", ",", "\"\<y\>\"", ",", "\"\<z\>\""}], "}"}]}], 
     "]"}]}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.861338408440855*^9, 3.861338418516376*^9}, {
   3.861338498842804*^9, 3.861338520240388*^9}, {3.861338566926754*^9, 
   3.861338665326042*^9}, {3.8613388044167747`*^9, 3.861338936988407*^9}, {
   3.861338969528871*^9, 3.861339292960884*^9}, {3.861339921733492*^9, 
   3.861339929669279*^9}, {3.8613401344168863`*^9, 3.861340145283572*^9}, {
   3.861340177009438*^9, 3.8613401770439863`*^9}, {3.8613403363090963`*^9, 
   3.861340369710449*^9}, 3.8613411892735033`*^9, {3.861341433872714*^9, 
   3.861341541928979*^9}, 3.8613416178289843`*^9, {3.86134170269693*^9, 
   3.861341710342662*^9}, {3.861341791187038*^9, 3.861341800588972*^9}, {
   3.861341977239245*^9, 3.861341989000125*^9}, {3.861342112233382*^9, 
   3.861342170369541*^9}, {3.861342291403901*^9, 3.861342375839484*^9}, 
   3.861342503035048*^9, {3.8613425865362797`*^9, 3.861342587091363*^9}, {
   3.8613433342779007`*^9, 3.8613433841299458`*^9}, {3.861347624256336*^9, 
   3.861347624772999*^9}, {3.8613476680072517`*^9, 3.861347713445569*^9}, {
   3.8613477996719503`*^9, 3.8613477998687468`*^9}, {3.861347927424914*^9, 
   3.861347944207137*^9}, {3.861348196186454*^9, 3.86134819656441*^9}, {
   3.861348233398818*^9, 3.8613482358480253`*^9}, {3.861348342525651*^9, 
   3.861348357593445*^9}, {3.8613484597976427`*^9, 3.8613484866312723`*^9}, {
   3.861348530805809*^9, 3.861348531249761*^9}, {3.8613491129680643`*^9, 
   3.861349132984394*^9}, {3.861350437197954*^9, 3.861350470649104*^9}, 
   3.861350689617165*^9, {3.861351992043208*^9, 3.861351992622573*^9}, {
   3.8613586654981413`*^9, 3.86135866576029*^9}, {3.861358726095152*^9, 
   3.8613587430945997`*^9}, {3.861358820532052*^9, 3.861359278034225*^9}, {
   3.861359308735271*^9, 3.8613594015830307`*^9}, {3.8613596689171143`*^9, 
   3.861359843489914*^9}, {3.861359876902413*^9, 3.861359880758278*^9}, {
   3.861359916076989*^9, 3.8613599368626423`*^9}, {3.8613600393487883`*^9, 
   3.8613600855494537`*^9}, {3.861360250691741*^9, 3.861360269117304*^9}, {
   3.861360301988138*^9, 3.861360919305134*^9}, {3.861360956683967*^9, 
   3.861360975784128*^9}, {3.8614319142688704`*^9, 3.861431914704186*^9}, {
   3.8614321285451107`*^9, 3.861432153870318*^9}, {3.861432282590652*^9, 
   3.861432327286655*^9}, {3.8614333161484337`*^9, 3.861433316297224*^9}, {
   3.8614333970128117`*^9, 3.8614334074225893`*^9}, {3.861433766475397*^9, 
   3.861433771999601*^9}, {3.8614339829047537`*^9, 3.861433995900278*^9}, {
   3.861435341887331*^9, 3.8614353470145397`*^9}, {3.861435393760079*^9, 
   3.8614354176433907`*^9}, {3.8614361865208387`*^9, 3.861436225171996*^9}, {
   3.861436293599936*^9, 3.8614365162145844`*^9}, {3.8614369365094013`*^9, 
   3.8614369954364853`*^9}, {3.861437722858502*^9, 3.861437781197995*^9}, {
   3.861438627514213*^9, 3.861438637342535*^9}, {3.8614393905725317`*^9, 
   3.861439467630929*^9}, {3.861439546890436*^9, 3.861439577638833*^9}, {
   3.861439618454582*^9, 3.861439740015753*^9}, {3.861439770648947*^9, 
   3.861439937851911*^9}, {3.861439969682248*^9, 3.861439970089126*^9}, {
   3.86167569613951*^9, 3.8616756965134087`*^9}, {3.861677565538392*^9, 
   3.861677566691628*^9}, {3.861678465042473*^9, 3.861678469464087*^9}, {
   3.8616800001917953`*^9, 3.861680005095893*^9}, {3.861680037345978*^9, 
   3.8616800375777273`*^9}, {3.861687862019176*^9, 3.861687862267653*^9}, 
   3.861695294653593*^9, {3.8616955293687572`*^9, 3.861695529507082*^9}, {
   3.8616965534411077`*^9, 3.861696553915875*^9}, {3.861761154807374*^9, 
   3.861761208788879*^9}, 3.861761304254138*^9, {3.861761380042927*^9, 
   3.861761400908828*^9}, {3.861761473361158*^9, 3.861761544544443*^9}, {
   3.861764540731557*^9, 3.8617645412446938`*^9}, {3.861765408846074*^9, 
   3.861765408934101*^9}, {3.8617661776684523`*^9, 3.8617661777779303`*^9}, {
   3.861767307103524*^9, 3.861767307602131*^9}, {3.861767707014377*^9, 
   3.861767743578685*^9}, {3.861767999660232*^9, 3.8617680043625183`*^9}, {
   3.861768129684114*^9, 3.861768145610506*^9}, 3.861768471945746*^9, 
   3.861768952678563*^9, {3.8617691723983583`*^9, 3.8617691727063227`*^9}, {
   3.861770015977324*^9, 3.861770050263172*^9}, {3.8617701362221937`*^9, 
   3.86177015350261*^9}, {3.8617714429852133`*^9, 3.861771456387843*^9}, {
   3.8617715342551947`*^9, 3.8617715414446497`*^9}, {3.8617717145019283`*^9, 
   3.861771722150889*^9}, {3.8617757273486853`*^9, 3.861775759902268*^9}, {
   3.861775807490211*^9, 3.861775877277999*^9}, {3.861781502015286*^9, 
   3.8617815153433*^9}, {3.861781545380322*^9, 3.861781582576099*^9}, {
   3.8617816183232803`*^9, 3.8617816385402527`*^9}, {3.8623720465271873`*^9, 
   3.862372046631278*^9}, {3.862379468277075*^9, 3.862379470653346*^9}, {
   3.862379503500278*^9, 3.86237954404366*^9}, {3.862379634532125*^9, 
   3.862379651268257*^9}, {3.862380622725027*^9, 3.862380627811261*^9}, {
   3.862380734639319*^9, 3.8623807585957203`*^9}, {3.86238088590346*^9, 
   3.8623809050959673`*^9}, {3.8623809358753557`*^9, 3.862380969447837*^9}, {
   3.8623810923874397`*^9, 3.862381109622254*^9}, {3.862381140606688*^9, 
   3.8623813758399982`*^9}, {3.8623814659382668`*^9, 3.862381495082123*^9}, {
   3.862381893746356*^9, 3.8623819795332747`*^9}, {3.862382017745945*^9, 
   3.8623820350125217`*^9}, {3.862382537141014*^9, 3.862382572323645*^9}, 
   3.862384018711256*^9, {3.862384302615313*^9, 3.862384333992906*^9}, {
   3.862384720717237*^9, 3.862384724184647*^9}, 3.862386032077119*^9, {
   3.862387632254387*^9, 3.862387632770857*^9}, {3.862392540470004*^9, 
   3.862392541003599*^9}, {3.8623928832303*^9, 3.862392897743534*^9}, {
   3.862449880509182*^9, 3.862450132581265*^9}, {3.862450163166744*^9, 
   3.86245021732302*^9}, {3.862450654595517*^9, 3.862450656707361*^9}, {
   3.862450707883615*^9, 3.862450708112667*^9}, {3.86245077440699*^9, 
   3.862450811589037*^9}, {3.862450861164073*^9, 3.86245089934503*^9}, {
   3.862450942131043*^9, 3.8624510260580187`*^9}, {3.8624511043492928`*^9, 
   3.862451136931954*^9}, {3.862452126185463*^9, 3.8624521561515093`*^9}, {
   3.862452192663686*^9, 3.8624522673626223`*^9}, {3.862452306094768*^9, 
   3.862452327699099*^9}, {3.862452366870784*^9, 3.8624525287408648`*^9}, {
   3.862452613212031*^9, 3.862452639831195*^9}, {3.8624526773060007`*^9, 
   3.862452698404711*^9}, {3.862452786300028*^9, 3.862452807801367*^9}, {
   3.862452852611876*^9, 3.8624529075510683`*^9}, {3.8624535534988203`*^9, 
   3.862453554939329*^9}, {3.862453651630678*^9, 3.862453652616493*^9}, {
   3.862453713838993*^9, 3.862453721705484*^9}, 3.8624537615759277`*^9, {
   3.862453819994843*^9, 3.862453980506547*^9}, {3.862454123607669*^9, 
   3.862454133275248*^9}, {3.862454171730115*^9, 3.8624542281620417`*^9}, 
   3.862454575050317*^9, {3.862454847731163*^9, 3.862454857829671*^9}, 
   3.86245500874691*^9, {3.8624550583577337`*^9, 3.862455117211253*^9}, {
   3.862455235320902*^9, 3.862455235497982*^9}, {3.862455310440278*^9, 
   3.862455310871181*^9}, 3.862455361278808*^9, {3.862455431215825*^9, 
   3.8624554482246847`*^9}, {3.8624555099955063`*^9, 3.862455510069354*^9}, 
   3.862455769882937*^9, {3.862455910017606*^9, 3.862455913891939*^9}, 
   3.862456161268098*^9, {3.862456195935994*^9, 3.862456243695665*^9}, {
   3.862456284518115*^9, 3.862456302315361*^9}, 3.862456369882173*^9, {
   3.8624564128695908`*^9, 3.862456413224409*^9}, {3.862456517426859*^9, 
   3.862456518442919*^9}, {3.862456593806892*^9, 3.86245679466511*^9}, {
   3.862457954229849*^9, 3.862457957804572*^9}, 3.862458371966878*^9, {
   3.862466315044854*^9, 3.862466320869852*^9}, {3.862466931168869*^9, 
   3.8624669314072657`*^9}, {3.8624678430733347`*^9, 3.86246784312814*^9}, 
   3.862468974834798*^9, {3.8624690609616413`*^9, 3.8624690617180367`*^9}, 
   3.86246913656009*^9, {3.862469167224393*^9, 3.862469177359838*^9}, {
   3.862469252767165*^9, 3.8624692817266273`*^9}, {3.8624693450323668`*^9, 
   3.862469357335478*^9}, 3.862469401679996*^9, {3.8624694330421753`*^9, 
   3.862469433308136*^9}, {3.8624718002287073`*^9, 3.862471804562212*^9}, {
   3.862471835917863*^9, 3.86247185265842*^9}, {3.86247189479842*^9, 
   3.8624718954645977`*^9}, {3.86247258950554*^9, 3.8624725906082363`*^9}, {
   3.862473028997674*^9, 3.862473030320434*^9}, {3.86247340035972*^9, 
   3.862473400895876*^9}, 3.862473596518783*^9, 3.862473886924206*^9, {
   3.862474068536745*^9, 3.862474070992055*^9}, 3.862474289179076*^9, {
   3.862474387812418*^9, 3.862474389350926*^9}},
 CellLabel->
  "In[8456]:=",ExpressionUUID->"ee34dac1-baef-424f-a299-22c8d32aaae5"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Introduce Strain", "Section",
 CellChangeTimes->{{3.861338402462072*^9, 3.861338407262868*^9}, {
  3.8623720551807947`*^9, 3.8623720605574217`*^9}, {3.862469916867041*^9, 
  3.862469924610751*^9}},ExpressionUUID->"93a277f6-7bae-49be-b605-\
d4a7db75a702"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"gaussian", " ", "strain", " ", "profile"}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"Clear", "[", "strainFieldGaussian", "]"}], "\[IndentingNewLine]", 
   
   RowBox[{
    RowBox[{"strainFieldGaussian", "[", 
     RowBox[{"n_", ",", "\[Sigma]n_"}], "]"}], ":=", 
    RowBox[{"N", "[", 
     RowBox[{
      FractionBox["1", 
       SqrtBox[
        RowBox[{"2", "\[Pi]", " ", 
         SuperscriptBox["\[Sigma]n", "2"]}]]], " ", 
      RowBox[{"Exp", "[", 
       RowBox[{"-", 
        FractionBox[
         SuperscriptBox[
          RowBox[{"Norm", "[", "n", "]"}], "2"], 
         RowBox[{"2", 
          SuperscriptBox["\[Sigma]n", "2"]}]]}], " ", "]"}]}], "]"}]}], "\n", 
   
   RowBox[{
    RowBox[{"nhat", "=", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", 
       RowBox[{"0.1", 
        SuperscriptBox["L", "2"]}]}], " ", "}"}]}], ";", 
    RowBox[{"r0", "=", 
     RowBox[{
      RowBox[{"Mean", "[", 
       RowBox[{"latt", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", "1"}], "]"}], "]"}], "]"}], "+", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"L", "/", "4"}], ",", 
        RowBox[{"0", 
         RowBox[{"L", "/", "4"}]}], ",", "0"}], "}"}]}]}], ";", 
    RowBox[{"\[Sigma]d", "=", 
     RowBox[{"L", "/", "6"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"deformedLatt", "=", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Chop", "[", 
          RowBox[{
           RowBox[{"#", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "+", 
           RowBox[{
            RowBox[{"strainFieldGaussian", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"#", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "-", "r0"}], ",", 
              "\[Sigma]d"}], "]"}], "*", "nhat"}]}], "]"}], ",", 
         RowBox[{"#", "[", 
          RowBox[{"[", "2", "]"}], "]"}]}], "}"}], "&"}], "/@", "latt"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"deformedLattBR", "=", 
     RowBox[{
      RowBox[{
       RowBox[{"deformedLatt", "[", 
        RowBox[{"[", "#", "]"}], "]"}], "&"}], "/@", 
      RowBox[{"Flatten", "[", "bPos", "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"deformedLattIN", "=", 
     RowBox[{
      RowBox[{
       RowBox[{"deformedLatt", "[", 
        RowBox[{"[", "#", "]"}], "]"}], "&"}], "/@", 
      RowBox[{"Flatten", "[", "inPos", "]"}]}]}], ";"}], "\n", 
   RowBox[{"Clear", "[", "deformedLattRegions", "]"}], "\[IndentingNewLine]", 
   
   RowBox[{
    RowBox[{
     RowBox[{"Evaluate", "[", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"deformedLattRegions", "[", "i", "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "uc", "]"}]}], "}"}]}], "]"}], "]"}], "=", 
     RowBox[{"Evaluate", "[", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"DeleteCases", "[", 
         RowBox[{"deformedLatt", ",", 
          RowBox[{"_", "?", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"Not", "[", 
              RowBox[{
               RowBox[{"#", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "\[Equal]", "i"}], "]"}], 
             "&"}], ")"}]}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "uc", "]"}]}], "}"}]}], "]"}], "]"}]}], 
    ";"}], "\n", 
   RowBox[{
    RowBox[{"deformedLattPlot", "=", 
     RowBox[{"Graphics3D", "[", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"lattCols", "[", 
             RowBox[{"[", 
              RowBox[{"#", "[", 
               RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], ",", 
            RowBox[{"Sphere", "[", 
             RowBox[{
              RowBox[{"#", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", "ss"}], "]"}]}], "}"}], 
          "&"}], "/@", 
         RowBox[{"deformedLattRegions", "[", "i", "]"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "2"}], "}"}]}], "}"}]}], "]"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"deformedBoundaryPlot", "=", 
     RowBox[{"Graphics3D", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"boundaryCols", "[", 
           RowBox[{"[", 
            RowBox[{"#", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], ",", 
          RowBox[{"Sphere", "[", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", "ss"}], "]"}]}], "}"}], 
        "&"}], "/@", "deformedLattBR"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"deformedInjectionPlot", "=", 
     RowBox[{"Graphics3D", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"injectionCols", "[", 
           RowBox[{"[", 
            RowBox[{"#", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], ",", 
          RowBox[{"Sphere", "[", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", "ss"}], "]"}]}], "}"}], 
        "&"}], "/@", "deformedLattIN"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"deformedNodesPlot", "=", 
     RowBox[{"Show", "[", 
      RowBox[{
      "deformedLattPlot", ",", "deformedBoundaryPlot", ",", 
       "deformedInjectionPlot"}], "]"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{"maxZ", "=", 
     RowBox[{"Max", "[", 
      RowBox[{"deformedLatt", "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", "1", ",", "3"}], "]"}], "]"}], "]"}]}], ";"}], 
   "\n", 
   RowBox[{"Clear", "[", "cs", "]"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{"cs", "[", "x_", "]"}], ":=", 
      RowBox[{
       RowBox[{"ColorData", "[", "\"\<PigeonTones\>\"", "]"}], "[", "x", 
       "]"}]}], ";"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{"cs", "[", "x_", "]"}], ":=", 
      RowBox[{"Directive", "[", 
       RowBox[{"Black", ",", 
        RowBox[{"Opacity", "[", 
         RowBox[{"1", "-", "x"}], "]"}]}], "]"}]}], ";"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"cs", "[", "x_", "]"}], ":=", 
     RowBox[{"Directive", "[", 
      RowBox[{"Blend", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Black", ",", "White"}], "}"}], ",", "x"}], "]"}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"deformedNNPlot", "=", 
     RowBox[{"Graphics3D", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Black", ",", 
            RowBox[{"CapForm", "[", "\"\<Butt\>\"", "]"}], ",", 
            RowBox[{"Tube", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"deformedLatt", "[", 
                 RowBox[{"[", 
                  RowBox[{
                   RowBox[{"#", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", "1"}], "]"}], "]"}], 
                ",", 
                RowBox[{"deformedLatt", "[", 
                 RowBox[{"[", 
                  RowBox[{
                   RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], ",", "1"}], "]"}], 
                 "]"}]}], "}"}], ",", "ts"}], "]"}]}], "}"}], "&"}], "/@", 
         RowBox[{"neighbors", "[", 
          RowBox[{"[", "2", "]"}], "]"}]}], "}"}], ",", 
       RowBox[{"ViewPoint", "\[Rule]", "Top"}], ",", 
       RowBox[{"AxesLabel", "\[Rule]", 
        RowBox[{"MaTeX", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "<>", "dunit"}], "&"}], "/@", 
          RowBox[{"{", 
           RowBox[{"\"\<x\>\"", ",", "\"\<y\>\"", ",", "\"\<z\>\""}], "}"}]}],
          "]"}]}]}], "]"}]}], ";"}], "\n", 
   RowBox[{"Show", "[", 
    RowBox[{"deformedNodesPlot", ",", "deformedNNPlot", ",", 
     RowBox[{"ViewPoint", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"Right", ",", "Above"}], "}"}]}], ",", 
     RowBox[{"Axes", "\[Rule]", "True"}], ",", 
     RowBox[{"AxesLabel", "\[Rule]", 
      RowBox[{"MaTeX", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"#", "<>", "dunit"}], "&"}], "/@", 
        RowBox[{"{", 
         RowBox[{"\"\<x\>\"", ",", "\"\<y\>\"", ",", "\"\<z\>\""}], "}"}]}], 
       "]"}]}]}], "]"}], "\[IndentingNewLine]", 
   RowBox[{"Show", "[", 
    RowBox[{"%", ",", 
     RowBox[{"ViewPoint", "\[Rule]", 
      RowBox[{"{", "Front", "}"}]}], ",", 
     RowBox[{"Axes", "\[Rule]", "True"}], ",", 
     RowBox[{"AxesLabel", "\[Rule]", 
      RowBox[{"MaTeX", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"#", "<>", "dunit"}], "&"}], "/@", 
        RowBox[{"{", 
         RowBox[{"\"\<x\>\"", ",", "\"\<y\>\"", ",", "\"\<z\>\""}], "}"}]}], 
       "]"}]}]}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.861338408440855*^9, 3.861338418516376*^9}, {
   3.861338498842804*^9, 3.861338520240388*^9}, {3.861338566926754*^9, 
   3.861338665326042*^9}, {3.8613388044167747`*^9, 3.861338936988407*^9}, {
   3.861338969528871*^9, 3.861339292960884*^9}, {3.861339921733492*^9, 
   3.861339929669279*^9}, {3.8613401344168863`*^9, 3.861340145283572*^9}, {
   3.861340177009438*^9, 3.8613401770439863`*^9}, {3.8613403363090963`*^9, 
   3.861340369710449*^9}, 3.8613411892735033`*^9, {3.861341433872714*^9, 
   3.861341541928979*^9}, 3.8613416178289843`*^9, {3.86134170269693*^9, 
   3.861341710342662*^9}, {3.861341791187038*^9, 3.861341800588972*^9}, {
   3.861341977239245*^9, 3.861341989000125*^9}, {3.861342112233382*^9, 
   3.861342170369541*^9}, {3.861342291403901*^9, 3.861342375839484*^9}, 
   3.861342503035048*^9, {3.8613425865362797`*^9, 3.861342587091363*^9}, {
   3.8613433342779007`*^9, 3.8613433841299458`*^9}, {3.861347624256336*^9, 
   3.861347624772999*^9}, {3.8613476680072517`*^9, 3.861347713445569*^9}, {
   3.8613477996719503`*^9, 3.8613477998687468`*^9}, {3.861347927424914*^9, 
   3.861347944207137*^9}, {3.861348196186454*^9, 3.86134819656441*^9}, {
   3.861348233398818*^9, 3.8613482358480253`*^9}, {3.861348342525651*^9, 
   3.861348357593445*^9}, {3.8613484597976427`*^9, 3.8613484866312723`*^9}, {
   3.861348530805809*^9, 3.861348531249761*^9}, {3.8613491129680643`*^9, 
   3.861349132984394*^9}, {3.861350437197954*^9, 3.861350470649104*^9}, 
   3.861350689617165*^9, {3.861351992043208*^9, 3.861351992622573*^9}, {
   3.8613586654981413`*^9, 3.86135866576029*^9}, {3.861358726095152*^9, 
   3.8613587430945997`*^9}, {3.861358820532052*^9, 3.861359278034225*^9}, {
   3.861359308735271*^9, 3.8613594015830307`*^9}, {3.8613596689171143`*^9, 
   3.861359843489914*^9}, {3.861359876902413*^9, 3.861359880758278*^9}, {
   3.861359916076989*^9, 3.8613599368626423`*^9}, {3.8613600393487883`*^9, 
   3.8613600855494537`*^9}, {3.861360250691741*^9, 3.861360269117304*^9}, {
   3.861360301988138*^9, 3.861360919305134*^9}, {3.861360956683967*^9, 
   3.861360975784128*^9}, {3.8614319142688704`*^9, 3.861431914704186*^9}, {
   3.8614321285451107`*^9, 3.861432153870318*^9}, {3.861432282590652*^9, 
   3.861432327286655*^9}, {3.8614333161484337`*^9, 3.861433316297224*^9}, {
   3.8614333970128117`*^9, 3.8614334074225893`*^9}, {3.861433766475397*^9, 
   3.861433771999601*^9}, {3.8614339829047537`*^9, 3.861433995900278*^9}, {
   3.861435341887331*^9, 3.8614353470145397`*^9}, {3.861435393760079*^9, 
   3.8614354176433907`*^9}, {3.8614361865208387`*^9, 3.861436225171996*^9}, {
   3.861436293599936*^9, 3.8614365162145844`*^9}, {3.8614369365094013`*^9, 
   3.8614369954364853`*^9}, {3.861437722858502*^9, 3.861437781197995*^9}, {
   3.861438627514213*^9, 3.861438637342535*^9}, {3.8614393905725317`*^9, 
   3.861439467630929*^9}, {3.861439546890436*^9, 3.861439577638833*^9}, {
   3.861439618454582*^9, 3.861439740015753*^9}, {3.861439770648947*^9, 
   3.861439937851911*^9}, {3.861439969682248*^9, 3.861439970089126*^9}, {
   3.86167569613951*^9, 3.8616756965134087`*^9}, {3.861677565538392*^9, 
   3.861677566691628*^9}, {3.861678465042473*^9, 3.861678469464087*^9}, {
   3.8616800001917953`*^9, 3.861680005095893*^9}, {3.861680037345978*^9, 
   3.8616800375777273`*^9}, {3.861687862019176*^9, 3.861687862267653*^9}, 
   3.861695294653593*^9, {3.8616955293687572`*^9, 3.861695529507082*^9}, {
   3.8616965534411077`*^9, 3.861696553915875*^9}, {3.861761154807374*^9, 
   3.861761208788879*^9}, 3.861761304254138*^9, {3.861761380042927*^9, 
   3.861761400908828*^9}, {3.861761473361158*^9, 3.861761544544443*^9}, {
   3.861764540731557*^9, 3.8617645412446938`*^9}, {3.861765408846074*^9, 
   3.861765408934101*^9}, {3.8617661776684523`*^9, 3.8617661777779303`*^9}, {
   3.861767307103524*^9, 3.861767307602131*^9}, {3.861767707014377*^9, 
   3.861767743578685*^9}, {3.861767999660232*^9, 3.8617680043625183`*^9}, {
   3.861768129684114*^9, 3.861768145610506*^9}, 3.861768471945746*^9, 
   3.861768952678563*^9, {3.8617691723983583`*^9, 3.8617691727063227`*^9}, {
   3.861770015977324*^9, 3.861770050263172*^9}, {3.8617701362221937`*^9, 
   3.86177015350261*^9}, {3.8617714429852133`*^9, 3.861771456387843*^9}, {
   3.8617715342551947`*^9, 3.8617715414446497`*^9}, {3.8617717145019283`*^9, 
   3.861771722150889*^9}, {3.8617757273486853`*^9, 3.861775759902268*^9}, {
   3.861775807490211*^9, 3.861775877277999*^9}, {3.861781502015286*^9, 
   3.8617815153433*^9}, {3.861781545380322*^9, 3.861781582576099*^9}, {
   3.8617816183232803`*^9, 3.8617816385402527`*^9}, {3.8623720465271873`*^9, 
   3.862372046631278*^9}, {3.862379468277075*^9, 3.862379470653346*^9}, {
   3.862379503500278*^9, 3.86237954404366*^9}, {3.862379634532125*^9, 
   3.862379651268257*^9}, {3.862380622725027*^9, 3.862380627811261*^9}, {
   3.862380734639319*^9, 3.8623807585957203`*^9}, {3.86238088590346*^9, 
   3.8623809050959673`*^9}, {3.8623809358753557`*^9, 3.862380969447837*^9}, {
   3.8623810923874397`*^9, 3.862381109622254*^9}, {3.862381140606688*^9, 
   3.8623813758399982`*^9}, {3.8623814659382668`*^9, 3.862381495082123*^9}, {
   3.862381893746356*^9, 3.8623819795332747`*^9}, {3.862382017745945*^9, 
   3.8623820350125217`*^9}, {3.862382537141014*^9, 3.862382572323645*^9}, 
   3.862384018711256*^9, {3.862384302615313*^9, 3.862384333992906*^9}, {
   3.862384720717237*^9, 3.862384724184647*^9}, 3.862386032077119*^9, {
   3.862387632254387*^9, 3.862387632770857*^9}, {3.862392540470004*^9, 
   3.862392541003599*^9}, {3.8623928832303*^9, 3.862392897743534*^9}, {
   3.862449880509182*^9, 3.862450132581265*^9}, {3.862450163166744*^9, 
   3.86245021732302*^9}, {3.862450654595517*^9, 3.862450656707361*^9}, {
   3.862450707883615*^9, 3.862450708112667*^9}, {3.86245077440699*^9, 
   3.862450811589037*^9}, {3.862450861164073*^9, 3.86245089934503*^9}, {
   3.862450942131043*^9, 3.8624510260580187`*^9}, {3.8624511043492928`*^9, 
   3.862451136931954*^9}, {3.862452126185463*^9, 3.8624521561515093`*^9}, {
   3.862452192663686*^9, 3.8624522673626223`*^9}, {3.862452306094768*^9, 
   3.862452327699099*^9}, {3.862452366870784*^9, 3.8624525287408648`*^9}, {
   3.862452613212031*^9, 3.862452639831195*^9}, {3.8624526773060007`*^9, 
   3.862452698404711*^9}, {3.862452786300028*^9, 3.862452807801367*^9}, {
   3.862452852611876*^9, 3.8624529075510683`*^9}, {3.8624535534988203`*^9, 
   3.862453554939329*^9}, {3.862453651630678*^9, 3.862453652616493*^9}, {
   3.862453713838993*^9, 3.862453721705484*^9}, 3.8624537615759277`*^9, {
   3.862453819994843*^9, 3.862453980506547*^9}, {3.862454123607669*^9, 
   3.862454133275248*^9}, {3.862454171730115*^9, 3.8624542281620417`*^9}, 
   3.862454575050317*^9, {3.862454847731163*^9, 3.862454857829671*^9}, 
   3.86245500874691*^9, {3.8624550583577337`*^9, 3.862455117211253*^9}, {
   3.862455235320902*^9, 3.862455235497982*^9}, {3.862455310440278*^9, 
   3.862455310871181*^9}, 3.862455361278808*^9, {3.862455431215825*^9, 
   3.8624554482246847`*^9}, {3.8624555099955063`*^9, 3.862455510069354*^9}, {
   3.862455769882937*^9, 3.8624558453397017`*^9}, {3.8624558918130283`*^9, 
   3.862455892301608*^9}, {3.86245592235644*^9, 3.862455950882144*^9}, {
   3.862456205932989*^9, 3.8624562157339563`*^9}, {3.862456264130897*^9, 
   3.862456296528508*^9}, {3.862457855657372*^9, 3.862457855917762*^9}, {
   3.862457913525243*^9, 3.862457913813711*^9}, {3.862457990653166*^9, 
   3.862457990857849*^9}, {3.86245803724275*^9, 3.862458038108891*^9}, {
   3.8624663910494127`*^9, 3.862466395148247*^9}, {3.8624684131380787`*^9, 
   3.862468417514634*^9}, {3.862468674365309*^9, 3.862468675019472*^9}, {
   3.862469033863594*^9, 3.862469044833494*^9}, {3.86246910199184*^9, 
   3.8624691187984667`*^9}, {3.8624692367136087`*^9, 3.862469246256494*^9}, {
   3.8624693005892963`*^9, 3.86246933216162*^9}, {3.862469391725766*^9, 
   3.862469417064611*^9}, {3.8624694717788153`*^9, 3.8624695244221277`*^9}, 
   3.8624695581110573`*^9, {3.862469597861479*^9, 3.86246959799868*^9}, {
   3.8624696401201*^9, 3.8624696401550217`*^9}, {3.8624696789813004`*^9, 
   3.862469690725108*^9}, {3.862469731442122*^9, 3.862469732551671*^9}, 
   3.862469795093656*^9, {3.862469836469304*^9, 3.862469837041759*^9}, {
   3.862469953959896*^9, 3.8624699755200768`*^9}, {3.862470013113331*^9, 
   3.86247002151725*^9}, {3.8624702436930637`*^9, 3.862470272172406*^9}, {
   3.86247395581229*^9, 3.862473964209845*^9}, 3.862474134545753*^9, {
   3.862474248449746*^9, 3.862474248555532*^9}},
 CellLabel->
  "In[8519]:=",ExpressionUUID->"0333928c-7cf8-43be-9ac8-660f7cc83d75"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"custom", " ", "eigensystem"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"Clear", "[", "orderedEigensystem", "]"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"orderedEigensystem", "[", 
      RowBox[{"M_", ",", 
       RowBox[{"f_", ":", "Re"}]}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"eigsys", ",", " ", "order"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"eigsys", " ", "=", " ", 
         RowBox[{"Eigensystem", "[", "M", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"order", " ", "=", " ", 
         RowBox[{"Ordering", "[", 
          RowBox[{"f", "[", 
           RowBox[{"eigsys", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"eigsys", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "order"}], "]"}], "]"}], ",", 
          RowBox[{
           RowBox[{"eigsys", "[", 
            RowBox[{"[", 
             RowBox[{"2", ",", "order"}], "]"}], "]"}], "\[Transpose]"}]}], 
         "}"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "now", " ", "the", " ", "Hamiltonian", " ", "matrix", " ", "is", " ", 
     "simply", " ", "given", " ", "by", " ", "the", " ", "nearest", " ", 
     "neighbor", " ", "connections"}], " ", "*)"}], "\n", 
   RowBox[{
    RowBox[{"t0", "=", "1.0"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"H", "=", 
     RowBox[{"Normal", "[", 
      RowBox[{"SparseArray", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"#", "\[Rule]", " ", "t0"}], "&"}], "/@", 
        RowBox[{"neighbors", "[", 
         RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"{", 
      RowBox[{"energies", ",", "wavefunctions"}], "}"}], "=", 
     RowBox[{
      RowBox[{"orderedEigensystem", "[", "H", "]"}], "//", "Sort"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"imEnergies", "=", 
     RowBox[{"Im", "[", "energies", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"energies", "=", 
     RowBox[{"Re", "[", "energies", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"ListPlot", "[", "energies", "]"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"max", "=", 
     RowBox[{"Max", "[", "energies", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"min", "=", 
     RowBox[{"Min", "[", "energies", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"DeleteDuplicates", "[", 
     RowBox[{
      RowBox[{"Chop", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"wavefunctions", "\[ConjugateTranspose]"}], ".", "H", ".", 
         "wavefunctions"}], "-", 
        RowBox[{"DiagonalMatrix", "[", "energies", "]"}]}], "]"}], "//", 
      "Flatten"}], "]"}], "\[Equal]", 
    RowBox[{"{", "0", "}"}]}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Histogram", "[", 
     RowBox[{"energies", ",", 
      RowBox[{"{", 
       RowBox[{"min", ",", "max", ",", 
        FractionBox[
         RowBox[{"max", "-", "min"}], "54"]}], "}"}], ",", 
      "\"\<Probability\>\"", ",", 
      RowBox[{"PlotRange", "\[Rule]", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"-", "1.5"}], ",", "1.5"}], "}"}], ",", "Automatic"}], 
        "}"}]}]}], "]"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"{", 
      RowBox[{"bene", ",", "bvals"}], "}"}], "=", 
     RowBox[{"HistogramList", "[", 
      RowBox[{"energies", ",", 
       RowBox[{"{", 
        RowBox[{"min", ",", "max", ",", 
         FractionBox[
          RowBox[{"max", "-", "min"}], "31"]}], "}"}], ",", "Probability"}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"ListPlot", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"MovingAverage", "[", 
         RowBox[{"bene", ",", "2"}], "]"}], ",", 
        RowBox[{"bvals", "*", "2", "*", "\[Pi]"}]}], "}"}], "\[Transpose]"}], 
     ",", 
     RowBox[{"Joined", "\[Rule]", "True"}], ",", 
     RowBox[{"PlotTheme", "\[Rule]", "\"\<Scientific\>\""}], ",", 
     RowBox[{"FrameLabel", "\[Rule]", 
      RowBox[{"MaTeX", "[", 
       RowBox[{"{", 
        RowBox[{"\"\<E/t0\>\"", ",", "\"\<D(E)\>\""}], "}"}], "]"}]}]}], 
    "]"}]}]}]], "Input",
 CellChangeTimes->{
  3.861353378013893*^9, {3.861361024823642*^9, 3.861361032867996*^9}, {
   3.861361066190823*^9, 3.86136107514081*^9}, {3.861361293626861*^9, 
   3.861361428599628*^9}, {3.861432512918666*^9, 3.8614325235755053`*^9}, {
   3.8614333322215242`*^9, 3.861433383460948*^9}, {3.861433812132592*^9, 
   3.861433816128848*^9}, {3.861675585812179*^9, 3.8616755949232187`*^9}, {
   3.861680009835919*^9, 3.861680010350039*^9}, {3.8623805993029013`*^9, 
   3.8623806192939672`*^9}, {3.862381546616543*^9, 3.862381556063311*^9}, {
   3.862384875125102*^9, 3.8623848755385027`*^9}, 3.862454263032711*^9, 
   3.862466350564536*^9, {3.8624671837602262`*^9, 3.862467185076674*^9}, {
   3.8624673039659767`*^9, 3.8624673050744*^9}, {3.8624743208666983`*^9, 
   3.862474353704795*^9}},
 CellLabel->
  "In[8537]:=",ExpressionUUID->"580008bd-3cb9-4f3b-9967-201801c377f9"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "now", " ", "the", " ", "Hamiltonian", " ", "matrix", " ", "is", " ", 
    "simply", " ", "given", " ", "by", " ", "the", " ", "nearest", " ", 
    "neighbor", " ", "connections"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"Clear", "[", 
    RowBox[{"t0", ",", "\[Beta]", ",", "d"}], "]"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"t0", "=", "1.0"}], ";", 
    RowBox[{"\[Beta]", "=", "3.37"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"d", "[", 
     RowBox[{"n1_", ",", "n2_", ",", "latt_"}], "]"}], ":=", 
    FractionBox[
     RowBox[{
      RowBox[{"Norm", "[", 
       RowBox[{
        RowBox[{"latt", "[", 
         RowBox[{"[", 
          RowBox[{"n1", ",", "1"}], "]"}], "]"}], "-", 
        RowBox[{"latt", "[", 
         RowBox[{"[", 
          RowBox[{"n2", ",", "1"}], "]"}], "]"}]}], "]"}], "-", "a"}], "a"]}],
    "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Hdef", "=", 
     RowBox[{"Normal", "[", 
      RowBox[{"SparseArray", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"#", "\[Rule]", " ", 
          RowBox[{"t0", "*", 
           RowBox[{"Exp", "[", 
            RowBox[{
             RowBox[{"-", "\[Beta]"}], " ", 
             RowBox[{"d", "[", 
              RowBox[{
               RowBox[{"#", "[", 
                RowBox[{"[", "1", "]"}], "]"}], ",", 
               RowBox[{"#", "[", 
                RowBox[{"[", "2", "]"}], "]"}], ",", "deformedLatt"}], 
              "]"}]}], "]"}]}]}], "&"}], "/@", 
        RowBox[{"neighbors", "[", 
         RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"{", 
      RowBox[{"energies", ",", "wavefunctions"}], "}"}], "=", 
     RowBox[{
      RowBox[{"orderedEigensystem", "[", "Hdef", "]"}], "//", "Sort"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"imEnergies", "=", 
     RowBox[{"Im", "[", "energies", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"energies", "=", 
     RowBox[{"Re", "[", "energies", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"ListPlot", "[", "energies", "]"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"max", "=", 
     RowBox[{"Max", "[", "energies", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"min", "=", 
     RowBox[{"Min", "[", "energies", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"DeleteDuplicates", "[", 
     RowBox[{
      RowBox[{"Chop", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"wavefunctions", "\[ConjugateTranspose]"}], ".", "Hdef", ".",
          "wavefunctions"}], "-", 
        RowBox[{"DiagonalMatrix", "[", "energies", "]"}]}], "]"}], "//", 
      "Flatten"}], "]"}], "\[Equal]", 
    RowBox[{"{", "0", "}"}]}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Histogram", "[", 
     RowBox[{"energies", ",", 
      RowBox[{"{", 
       RowBox[{"min", ",", "max", ",", 
        FractionBox[
         RowBox[{"max", "-", "min"}], "54"]}], "}"}], ",", 
      "\"\<Probability\>\"", ",", 
      RowBox[{"PlotRange", "\[Rule]", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"-", "1.5"}], ",", "1.5"}], "}"}], ",", "Automatic"}], 
        "}"}]}]}], "]"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"{", 
      RowBox[{"bene", ",", "bvals"}], "}"}], "=", 
     RowBox[{"HistogramList", "[", 
      RowBox[{"energies", ",", 
       RowBox[{"{", 
        RowBox[{"min", ",", "max", ",", 
         FractionBox[
          RowBox[{"max", "-", "min"}], "31"]}], "}"}], ",", "Probability"}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"ListPlot", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"MovingAverage", "[", 
         RowBox[{"bene", ",", "2"}], "]"}], ",", 
        RowBox[{"bvals", "*", "2", "*", "\[Pi]"}]}], "}"}], "\[Transpose]"}], 
     ",", 
     RowBox[{"Joined", "\[Rule]", "True"}], ",", 
     RowBox[{"PlotTheme", "\[Rule]", "\"\<Scientific\>\""}], ",", 
     RowBox[{"FrameLabel", "\[Rule]", 
      RowBox[{"MaTeX", "[", 
       RowBox[{"{", 
        RowBox[{"\"\<E/t0\>\"", ",", "\"\<D(E)\>\""}], "}"}], "]"}]}]}], 
    "]"}]}]}]], "Input",
 CellChangeTimes->{
  3.861353378013893*^9, {3.861361024823642*^9, 3.861361032867996*^9}, {
   3.861361066190823*^9, 3.86136107514081*^9}, {3.861361293626861*^9, 
   3.861361428599628*^9}, {3.861432512918666*^9, 3.8614325235755053`*^9}, {
   3.8614333322215242`*^9, 3.861433383460948*^9}, {3.861433812132592*^9, 
   3.861433816128848*^9}, {3.861675585812179*^9, 3.8616755949232187`*^9}, {
   3.861680009835919*^9, 3.861680010350039*^9}, {3.8623805993029013`*^9, 
   3.8623806192939672`*^9}, {3.862381546616543*^9, 3.862381562567821*^9}, {
   3.862381606212275*^9, 3.862381619172974*^9}, {3.862384876993555*^9, 
   3.862384877483691*^9}, {3.862392805268282*^9, 3.8623928634015837`*^9}, {
   3.86239296529583*^9, 3.86239297779657*^9}, {3.862393073999251*^9, 
   3.862393077730969*^9}, {3.862393117576867*^9, 3.8623933172828903`*^9}, {
   3.862393352815419*^9, 3.862393362850946*^9}, {3.862449832815797*^9, 
   3.862449833362122*^9}, {3.862449866634925*^9, 3.862449872432704*^9}, {
   3.862453157707679*^9, 3.862453158721895*^9}, {3.8624531946667852`*^9, 
   3.862453195656476*^9}, {3.862453407666336*^9, 3.862453410660873*^9}, {
   3.8624663564565897`*^9, 3.862466356746516*^9}, 3.862467961830467*^9, {
   3.862474342210009*^9, 3.862474348021693*^9}},
 CellLabel->
  "In[8550]:=",ExpressionUUID->"46666165-96dd-4ccb-ad7c-b5e1d5f8f8a8"],

Cell[BoxData[{
 RowBox[{"MinMax", "[", 
  RowBox[{
   RowBox[{
    RowBox[{"t0", "*", 
     RowBox[{"Exp", "[", 
      RowBox[{
       RowBox[{"-", "\[Beta]"}], " ", 
       RowBox[{"d", "[", 
        RowBox[{
         RowBox[{"#", "[", 
          RowBox[{"[", "1", "]"}], "]"}], ",", 
         RowBox[{"#", "[", 
          RowBox[{"[", "2", "]"}], "]"}], ",", "latt"}], "]"}]}], "]"}]}], 
    "&"}], "/@", 
   RowBox[{"neighbors", "[", 
    RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"{", 
   RowBox[{"minDT", ",", "maxDT"}], "}"}], "=", 
  RowBox[{"MinMax", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"Exp", "[", 
      RowBox[{
       RowBox[{"-", "\[Beta]"}], " ", 
       RowBox[{"d", "[", 
        RowBox[{
         RowBox[{"#", "[", 
          RowBox[{"[", "1", "]"}], "]"}], ",", 
         RowBox[{"#", "[", 
          RowBox[{"[", "2", "]"}], "]"}], ",", "deformedLatt"}], "]"}]}], 
      "]"}], "&"}], "/@", 
    RowBox[{"neighbors", "[", 
     RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"MinMax", "[", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{"Exp", "[", 
        RowBox[{
         RowBox[{"-", "\[Beta]"}], " ", 
         RowBox[{"d", "[", 
          RowBox[{
           RowBox[{"#", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", 
           RowBox[{"#", "[", 
            RowBox[{"[", "2", "]"}], "]"}], ",", "deformedLatt"}], "]"}]}], 
        "]"}], "-", "minDT"}], ")"}], "/", 
     RowBox[{"(", 
      RowBox[{"maxDT", "-", "minDT"}], ")"}]}], "&"}], "/@", 
   RowBox[{"neighbors", "[", 
    RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.8624544487778463`*^9, 3.862454490525477*^9}, {
   3.8624546645757017`*^9, 3.862454685348291*^9}, {3.8624547852022247`*^9, 
   3.8624548012680893`*^9}, {3.862468005890594*^9, 3.862468023021864*^9}, {
   3.862468113912339*^9, 3.8624681545211487`*^9}, 3.862468268275079*^9},
 CellLabel->
  "In[8563]:=",ExpressionUUID->"cfc3b200-9be3-4bc9-b1e7-8bbf0607a9d5"],

Cell[BoxData[
 RowBox[{"strain", "=", 
  RowBox[{"Graphics3D", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"cs", "[", 
          RowBox[{"1", "-", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"Exp", "[", 
               RowBox[{
                RowBox[{"-", "\[Beta]"}], " ", 
                RowBox[{"d", "[", 
                 RowBox[{
                  RowBox[{"#", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], ",", 
                  RowBox[{"#", "[", 
                   RowBox[{"[", "2", "]"}], "]"}], ",", "deformedLatt"}], 
                 "]"}]}], "]"}], "-", "minDT"}], ")"}], "/", 
            RowBox[{"(", 
             RowBox[{"maxDT", "-", "minDT"}], ")"}]}]}], "]"}], ",", 
         RowBox[{"CapForm", "[", "\"\<Butt\>\"", "]"}], ",", 
         RowBox[{"Tube", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"deformedLatt", "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{"#", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], ",", "1"}], "]"}], "]"}], 
             ",", 
             RowBox[{"deformedLatt", "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{"#", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], ",", "1"}], "]"}], "]"}]}], 
            "}"}], ",", "ts"}], "]"}]}], "}"}], "&"}], "/@", 
      RowBox[{"neighbors", "[", 
       RowBox[{"[", "2", "]"}], "]"}]}], "}"}], ",", 
    RowBox[{"ViewPoint", "\[Rule]", "Above"}], ",", 
    RowBox[{"Background", "\[Rule]", "Black"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.862454380565233*^9, 3.8624544238613987`*^9}, {
   3.862454460735383*^9, 3.862454461724621*^9}, {3.862454499106135*^9, 
   3.8624545605132837`*^9}, {3.862454599338765*^9, 3.862454600276091*^9}, {
   3.8624546445991507`*^9, 3.8624546759430313`*^9}, {3.862454721502006*^9, 
   3.8624547702331467`*^9}, {3.8624548186577253`*^9, 3.862454823240513*^9}, 
   3.862454913690118*^9, {3.86245515509972*^9, 3.862455162875898*^9}, {
   3.862456908380876*^9, 3.8624569467902327`*^9}, {3.862458453999349*^9, 
   3.8624584634144917`*^9}, 3.8624585339462748`*^9, {3.862466414872418*^9, 
   3.8624664410062838`*^9}, {3.86246647172129*^9, 3.862466472325315*^9}, {
   3.862466503109664*^9, 3.862466643285438*^9}, {3.862468028512775*^9, 
   3.862468102864929*^9}, {3.862468166702791*^9, 3.862468252502554*^9}},
 CellLabel->
  "In[8566]:=",ExpressionUUID->"0e2a08ad-3c81-4ea4-9ce0-82c53adf1a13"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "wavefunctions", " ", "of", " ", "the", " ", "incected", " ", 
    "electrons"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"Clear", "[", "\[Chi]", "]"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"\[Chi]", "[", "1", "]"}], "[", 
     RowBox[{"r_", ",", "k_", ",", "\[Sigma]_", ",", "\[Phi]_"}], "]"}], ":=", 
    RowBox[{
     RowBox[{"Cm", "*", 
      SuperscriptBox["\[ExponentialE]", 
       RowBox[{"\[ImaginaryI]", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"k", "+", "Km"}], ")"}], ".", "r"}]}]]}], "+", 
     RowBox[{"Cp", "*", 
      SuperscriptBox["\[ExponentialE]", 
       RowBox[{"\[ImaginaryI]", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"k", "+", "Kp"}], ")"}], ".", "r"}]}]]}]}]}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"\[Chi]", "[", "2", "]"}], "[", 
     RowBox[{"r_", ",", "k_", ",", "\[Sigma]_", ",", "\[Phi]_"}], "]"}], ":=", 
    RowBox[{
     RowBox[{"\[Sigma]", " ", "Cm", " ", 
      SuperscriptBox["\[ExponentialE]", 
       RowBox[{
        RowBox[{"\[ImaginaryI]", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"k", "+", "Km"}], ")"}], ".", "r"}]}], " ", "+", " ", 
        RowBox[{"\[ImaginaryI]", " ", "\[Phi]"}]}]]}], "-", 
     RowBox[{"\[Sigma]", " ", "Cp", " ", 
      SuperscriptBox["\[ExponentialE]", 
       RowBox[{
        RowBox[{"\[ImaginaryI]", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"k", "+", "Kp"}], ")"}], ".", "r"}]}], " ", "-", " ", 
        RowBox[{"\[ImaginaryI]", " ", "\[Phi]"}]}]]}]}]}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Beam", " ", "forming"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"Clear", "[", "A", "]"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"A", "[", 
     RowBox[{"x_", ",", "x0_", ",", "w0_"}], "]"}], ":=", 
    RowBox[{"Exp", "[", 
     RowBox[{"-", 
      SuperscriptBox[
       RowBox[{"(", 
        FractionBox[
         RowBox[{"x", "-", "x0"}], "w0"], ")"}], "2"]}], "]"}]}]}]}]], "Input",\

 CellChangeTimes->{{3.862470931742872*^9, 3.862470945905835*^9}, {
  3.862471361921299*^9, 3.862471455966176*^9}, {3.8624721759047537`*^9, 
  3.862472226285831*^9}},
 CellLabel->
  "In[8567]:=",ExpressionUUID->"b6c6b485-3b8f-4c80-b030-766c55f7a1f8"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"x0in", "=", 
   RowBox[{"Mean", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"deformedLatt", "[", 
       RowBox[{"[", 
        RowBox[{"#", ",", "1", ",", "1"}], "]"}], "]"}], "&"}], "/@", 
     "inPos"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"minXIn", ",", "maxXIn"}], "}"}], "=", 
   RowBox[{"MinMax", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"deformedLatt", "[", 
       RowBox[{"[", 
        RowBox[{"#", ",", "1", ",", "1"}], "]"}], "]"}], "&"}], "/@", 
     "inPos"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ListPlot", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"A", "[", 
      RowBox[{
       RowBox[{"deformedLatt", "[", 
        RowBox[{"[", 
         RowBox[{"#", ",", "1", ",", "1"}], "]"}], "]"}], ",", "x0in", ",", 
       RowBox[{"1", "/", "2"}]}], "]"}], "&"}], "/@", "inPos"}], "]"}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.862472260973216*^9, 3.862472512878327*^9}, {
  3.862472612926033*^9, 3.86247261799018*^9}, {3.862473937972131*^9, 
  3.862473943955679*^9}},
 CellLabel->
  "In[8572]:=",ExpressionUUID->"0f73ff5a-ff69-4d34-99ba-d7e3e1e267e3"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"wide", "-", 
    RowBox[{"band", " ", "leaking", " ", "boundary"}]}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"\[Eta]", "=", 
     RowBox[{"1", "/", "t0"}]}], ";", 
    RowBox[{"vF", "=", 
     RowBox[{
      FractionBox["3", "2"], "t0", " ", "a"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"\[CapitalSigma]", "=", 
     RowBox[{"SparseArray", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"#", ",", "#"}], "}"}], "\[Rule]", 
         RowBox[{
          RowBox[{"-", " ", "\[ImaginaryI]"}], " ", "\[Eta]"}]}], "&"}], "/@", 
       RowBox[{"(", 
        RowBox[{"bPos", "//", "Flatten"}], ")"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ene", "=", 
     RowBox[{"1", "t0"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Kp", "=", 
     RowBox[{"{", 
      RowBox[{"0", ",", 
       FractionBox[
        RowBox[{
         RowBox[{"+", "4"}], "\[Pi]"}], 
        RowBox[{"3", 
         SqrtBox["3"], "a"}]], ",", "0"}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Km", "=", 
     RowBox[{"{", 
      RowBox[{"0", ",", 
       FractionBox[
        RowBox[{
         RowBox[{"-", "4"}], "\[Pi]"}], 
        RowBox[{"3", 
         SqrtBox["3"], "a"}]], ",", "0"}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"Kp", "=", 
      RowBox[{"{", 
       RowBox[{
        FractionBox[
         RowBox[{
          RowBox[{"+", "4"}], "\[Pi]"}], 
         RowBox[{"3", 
          SqrtBox["3"], "a"}]], ",", "0", ",", "0"}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Km", "=", 
      RowBox[{"{", 
       RowBox[{
        FractionBox[
         RowBox[{
          RowBox[{"-", "4"}], "\[Pi]"}], 
         RowBox[{"3", 
          SqrtBox["3"], "a"}]], ",", "0", ",", "0"}], "}"}]}], ";"}], "*)"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Cp", "=", "0.0"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Cm", "=", "1.0"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"kx", "=", "0"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ky", "=", 
     RowBox[{
      RowBox[{"Abs", "[", "ene", "]"}], "/", "vF"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"\[Phi]", "=", 
     RowBox[{"Arg", "[", 
      RowBox[{
       RowBox[{"\[ImaginaryI]", " ", "kx"}], " ", "+", " ", "ky"}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"\[Sigma]E", "=", 
     RowBox[{"Sign", "[", "ene", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"inTuples", "=", 
     RowBox[{"Tuples", "[", 
      RowBox[{"{", 
       RowBox[{"inPos", ",", "inPos"}], "}"}], "]"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{"\[CapitalSigma]inP", "=", 
     RowBox[{"0", "*", "H"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{"\[CapitalSigma]inP", "[", 
         RowBox[{"[", 
          RowBox[{"Sequence", "@@", "#"}], "]"}], "]"}], "=", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"\[Chi]", "[", 
            RowBox[{"deformedLatt", "[", 
             RowBox[{"[", 
              RowBox[{
               RowBox[{"#", "[", 
                RowBox[{"[", "1", "]"}], "]"}], ",", "2"}], "]"}], "]"}], 
            "]"}], "[", 
           RowBox[{
            RowBox[{"deformedLatt", "[", 
             RowBox[{"[", 
              RowBox[{
               RowBox[{"#", "[", 
                RowBox[{"[", "1", "]"}], "]"}], ",", "1"}], "]"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"kx", ",", "ky", ",", "0"}], "}"}], ",", "\[Sigma]E", 
            ",", "\[Phi]"}], "]"}], "\[Conjugate]"}], " ", 
         RowBox[{
          RowBox[{"\[Chi]", "[", 
           RowBox[{"deformedLatt", "[", 
            RowBox[{"[", 
             RowBox[{
              RowBox[{"#", "[", 
               RowBox[{"[", "2", "]"}], "]"}], ",", "2"}], "]"}], "]"}], 
           "]"}], "[", 
          RowBox[{
           RowBox[{"deformedLatt", "[", 
            RowBox[{"[", 
             RowBox[{
              RowBox[{"#", "[", 
               RowBox[{"[", "2", "]"}], "]"}], ",", "1"}], "]"}], "]"}], ",", 
           
           RowBox[{"{", 
            RowBox[{"kx", ",", "ky", ",", "0"}], "}"}], ",", "\[Sigma]E", ",",
            "\[Phi]"}], "]"}]}]}], ")"}], "&"}], "/@", "inTuples"}], 
    ";"}]}]}]], "Input",
 CellChangeTimes->{{3.861680428037607*^9, 3.861680465038351*^9}, {
   3.861760302531777*^9, 3.861760306449637*^9}, {3.86176420211625*^9, 
   3.861764207018589*^9}, {3.861764308664955*^9, 3.8617644383564577`*^9}, {
   3.8617645167484407`*^9, 3.8617645232461033`*^9}, {3.861764896338635*^9, 
   3.861764900865672*^9}, {3.861764973927784*^9, 3.861764992299336*^9}, {
   3.861765028642514*^9, 3.861765030225082*^9}, {3.8617669470596533`*^9, 
   3.861767100888239*^9}, {3.861767140959567*^9, 3.8617672996471443`*^9}, {
   3.861767388152668*^9, 3.861767542071639*^9}, {3.86176760404949*^9, 
   3.861767680964488*^9}, {3.86176794491117*^9, 3.8617679696727667`*^9}, 
   3.861768336751824*^9, {3.8617689847541933`*^9, 3.861768985893942*^9}, {
   3.861769099351112*^9, 3.861769099723093*^9}, {3.8617691419251127`*^9, 
   3.861769160032196*^9}, {3.861769241748329*^9, 3.861769242741987*^9}, {
   3.861769397760591*^9, 3.861769516554014*^9}, {3.8617695575803328`*^9, 
   3.861769672139999*^9}, {3.86177007645299*^9, 3.861770111232374*^9}, {
   3.8617702548894873`*^9, 3.861770313416233*^9}, {3.8617705347719383`*^9, 
   3.861770604051373*^9}, {3.861770673966518*^9, 3.861770699670542*^9}, {
   3.861770732354847*^9, 3.861770735666518*^9}, {3.861770767464555*^9, 
   3.861770774031423*^9}, {3.86177080796532*^9, 3.8617708090127897`*^9}, {
   3.86177084858703*^9, 3.861770861895232*^9}, {3.8617709274508*^9, 
   3.861770946244905*^9}, {3.861770989607337*^9, 3.861770992747612*^9}, {
   3.8617710625779963`*^9, 3.861771145849951*^9}, {3.861771226420226*^9, 
   3.8617712868567057`*^9}, {3.8617715109291887`*^9, 3.861771511179449*^9}, {
   3.861775346338788*^9, 3.8617753474595346`*^9}, {3.861775400993595*^9, 
   3.86177540159974*^9}, {3.861775445938592*^9, 3.861775447594882*^9}, {
   3.861775479974389*^9, 3.8617754807662697`*^9}, {3.8617757975920963`*^9, 
   3.861775798528091*^9}, {3.861776152816614*^9, 3.861776153098925*^9}, {
   3.861776197006073*^9, 3.8617761976279182`*^9}, {3.861776250957451*^9, 
   3.861776253695269*^9}, {3.861776300097451*^9, 3.861776301865267*^9}, {
   3.861776381343014*^9, 3.861776381675535*^9}, {3.861776422806561*^9, 
   3.86177642439923*^9}, {3.861776465717349*^9, 3.8617764662729483`*^9}, {
   3.861776504307125*^9, 3.861776506452546*^9}, {3.861790836878641*^9, 
   3.8617908644265633`*^9}, {3.8617925925866203`*^9, 3.861792592785383*^9}, {
   3.862379440861587*^9, 3.862379443500042*^9}, {3.8623797783272533`*^9, 
   3.8623797966205387`*^9}, {3.862387442127976*^9, 3.862387491859336*^9}, {
   3.862387521964925*^9, 3.8623875968399153`*^9}, {3.862387676068582*^9, 
   3.862387724997177*^9}, {3.862387778668825*^9, 3.862387814871768*^9}, {
   3.862392608579921*^9, 3.862392702735374*^9}, {3.8623927542899446`*^9, 
   3.862392754844028*^9}, {3.8623930192442493`*^9, 3.8623930878603907`*^9}, {
   3.8623933835925827`*^9, 3.862393440583508*^9}, {3.862393685829916*^9, 
   3.862393686072443*^9}, {3.86239386605687*^9, 3.862393867131136*^9}, {
   3.8624496123302317`*^9, 3.8624496182526073`*^9}, {3.862453057781434*^9, 
   3.862453057969841*^9}, {3.862453471268078*^9, 3.862453502072713*^9}, {
   3.862458188771047*^9, 3.8624581891893044`*^9}, {3.862458249486465*^9, 
   3.862458264694969*^9}, {3.862458299168325*^9, 3.862458299262282*^9}, {
   3.862466662430339*^9, 3.8624666775757647`*^9}, {3.86246757539219*^9, 
   3.862467603714926*^9}, {3.862467634053728*^9, 3.862467650807325*^9}, {
   3.862467809177422*^9, 3.862467821456102*^9}, {3.862468469255341*^9, 
   3.862468469701413*^9}, {3.862469771055553*^9, 3.862469783733288*^9}, 
   3.8624701813020782`*^9, {3.8624703511493187`*^9, 3.862470375127654*^9}, {
   3.862470601729141*^9, 3.8624706166804*^9}, {3.862470649272235*^9, 
   3.862470650932383*^9}, {3.862470802303218*^9, 3.862470809557598*^9}, {
   3.8624708710215263`*^9, 3.8624709271669283`*^9}, {3.862470971647895*^9, 
   3.8624710008124313`*^9}, {3.862471096612591*^9, 3.8624711221084642`*^9}, {
   3.862471920709001*^9, 3.862472048203062*^9}, {3.862472820973521*^9, 
   3.8624728216648483`*^9}, {3.862473009381774*^9, 3.862473013120233*^9}, {
   3.862473055948348*^9, 3.862473057562689*^9}, {3.862473100371056*^9, 
   3.8624731768708076`*^9}, {3.862473317779385*^9, 3.8624733188664618`*^9}, {
   3.862473357094083*^9, 3.86247338345713*^9}, {3.862473641522285*^9, 
   3.862473645706994*^9}, 
   3.862475738673634*^9},ExpressionUUID->"6424a4b9-5678-4b48-a680-\
8116c3e4226f"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"G", "=", 
   RowBox[{"Inverse", "[", 
    RowBox[{"N", "[", 
     RowBox[{
      RowBox[{"ene", "*", 
       RowBox[{"IdentityMatrix", "[", 
        RowBox[{"Dimensions", "[", "H", "]"}], "]"}]}], "-", "H", "-", 
      "\[CapitalSigma]"}], "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"GP", " ", "=", " ", 
    RowBox[{"G", ".", "\[CapitalSigma]inP", ".", 
     RowBox[{"G", "\[ConjugateTranspose]"}]}]}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"GP", "=", 
     RowBox[{"GP", "/", 
      RowBox[{"Max", "[", 
       RowBox[{"Abs", "[", 
        RowBox[{"Diagonal", "[", 
         RowBox[{"GP", ",", "1"}], "]"}], "]"}], "]"}]}]}], ";"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"nP", " ", "=", " ", 
   RowBox[{"Re", "[", 
    RowBox[{"Diagonal", "[", 
     RowBox[{"(", 
      RowBox[{"GP", "+", 
       RowBox[{"GP", "\[ConjugateTranspose]"}]}], ")"}], "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ppP", " ", "=", " ", 
    FractionBox[
     RowBox[{"Abs", "[", "nP", "]"}], 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"w", "=", 
          RowBox[{"Max", "[", 
           RowBox[{"Abs", "[", "nP", "]"}], "]"}]}], ")"}], ">", "1*^-8"}], 
       ",", "w", ",", "1"}], "]"}]]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"current", "=", 
   RowBox[{"Graphics3D", "[", 
    RowBox[{"{", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Blend", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"Red", ",", "White"}], "}"}], ",", 
             RowBox[{"1", "-", 
              SuperscriptBox[
               RowBox[{"#", "[", 
                RowBox[{"[", "1", "]"}], "]"}], 
               RowBox[{"(", 
                RowBox[{"1", "/", "2"}], ")"}]]}]}], "]"}], ",", 
           RowBox[{"Sphere", "[", 
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "2", "]"}], "]"}], ",", "ss"}], "]"}]}], "}"}], 
         "&"}], "/@", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"ppP", ",", 
            RowBox[{"latt", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", "1"}], "]"}], "]"}]}], "}"}], 
          "\[Transpose]"}], ")"}]}], ","}], "*)"}], 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Blend", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"Red", ",", "White"}], "}"}], ",", 
            RowBox[{"1", "-", 
             RowBox[{"Abs", "[", 
              RowBox[{"Im", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"H", "[", 
                  RowBox[{"[", 
                   RowBox[{"Sequence", "@@", "#"}], "]"}], "]"}], 
                 "\[Conjugate]"}], "*", 
                RowBox[{"GP", "[", 
                 RowBox[{"[", 
                  RowBox[{"Sequence", "@@", "#"}], "]"}], "]"}]}], "]"}], 
              "]"}]}]}], "]"}], ",", 
          RowBox[{"CapForm", "[", "\"\<Butt\>\"", "]"}], ",", 
          RowBox[{"Tube", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{
               RowBox[{"latt", "[", 
                RowBox[{"[", 
                 RowBox[{"All", ",", "1"}], "]"}], "]"}], "[", 
               RowBox[{"[", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], ",", 
              RowBox[{
               RowBox[{"latt", "[", 
                RowBox[{"[", 
                 RowBox[{"All", ",", "1"}], "]"}], "]"}], "[", 
               RowBox[{"[", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}]}], "}"}], ",", 
            "ts"}], "]"}]}], "}"}], "&"}], "/@", 
       RowBox[{"neighbors", "[", 
        RowBox[{"[", "2", "]"}], "]"}]}], "}"}], "}"}], "]"}]}], 
  ";"}], "\n", 
 RowBox[{"Show", "[", 
  RowBox[{"nodesPlot", ",", "nnPlot", ",", "current", ",", 
   RowBox[{"ViewPoint", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{"Right", ",", "Above"}], "}"}]}], ",", 
   RowBox[{"Boxed", "\[Rule]", "False"}], ",", 
   RowBox[{"Background", "\[Rule]", "Black"}], ",", 
   RowBox[{"Axes", "\[Rule]", "False"}]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"Show", "[", 
  RowBox[{"nodesPlot", ",", "nnPlot", ",", "current", ",", 
   RowBox[{"ViewPoint", "\[Rule]", "Above"}], ",", 
   RowBox[{"Boxed", "\[Rule]", "False"}], ",", 
   RowBox[{"Background", "\[Rule]", "Black"}], ",", 
   RowBox[{"Axes", "\[Rule]", "False"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.861680428037607*^9, 3.861680465038351*^9}, {
   3.861760302531777*^9, 3.861760306449637*^9}, {3.86176420211625*^9, 
   3.861764207018589*^9}, {3.861764308664955*^9, 3.8617644383564577`*^9}, {
   3.8617645167484407`*^9, 3.8617645232461033`*^9}, {3.861764896338635*^9, 
   3.861764900865672*^9}, {3.861764973927784*^9, 3.861764992299336*^9}, {
   3.861765028642514*^9, 3.861765030225082*^9}, {3.8617669470596533`*^9, 
   3.861767100888239*^9}, {3.861767140959567*^9, 3.8617672996471443`*^9}, {
   3.861767388152668*^9, 3.861767542071639*^9}, {3.86176760404949*^9, 
   3.861767680964488*^9}, {3.86176794491117*^9, 3.8617679696727667`*^9}, 
   3.861768336751824*^9, {3.8617689847541933`*^9, 3.861768985893942*^9}, {
   3.861769099351112*^9, 3.861769099723093*^9}, {3.8617691419251127`*^9, 
   3.861769160032196*^9}, {3.861769241748329*^9, 3.861769242741987*^9}, {
   3.861769397760591*^9, 3.861769516554014*^9}, {3.8617695575803328`*^9, 
   3.861769672139999*^9}, {3.86177007645299*^9, 3.861770111232374*^9}, {
   3.8617702548894873`*^9, 3.861770313416233*^9}, {3.8617705347719383`*^9, 
   3.861770604051373*^9}, {3.861770673966518*^9, 3.861770699670542*^9}, {
   3.861770732354847*^9, 3.861770735666518*^9}, {3.861770767464555*^9, 
   3.861770774031423*^9}, {3.86177080796532*^9, 3.8617708090127897`*^9}, {
   3.86177084858703*^9, 3.861770861895232*^9}, {3.8617709274508*^9, 
   3.861770946244905*^9}, {3.861770989607337*^9, 3.861770992747612*^9}, {
   3.8617710625779963`*^9, 3.861771145849951*^9}, {3.861771226420226*^9, 
   3.8617712868567057`*^9}, {3.8617715109291887`*^9, 3.861771511179449*^9}, {
   3.861775346338788*^9, 3.8617753474595346`*^9}, {3.861775400993595*^9, 
   3.86177540159974*^9}, {3.861775445938592*^9, 3.861775447594882*^9}, {
   3.861775479974389*^9, 3.8617754807662697`*^9}, {3.8617757975920963`*^9, 
   3.861775798528091*^9}, {3.861776152816614*^9, 3.861776153098925*^9}, {
   3.861776197006073*^9, 3.8617761976279182`*^9}, {3.861776250957451*^9, 
   3.861776253695269*^9}, {3.861776300097451*^9, 3.861776301865267*^9}, {
   3.861776381343014*^9, 3.861776381675535*^9}, {3.861776422806561*^9, 
   3.86177642439923*^9}, {3.861776465717349*^9, 3.8617764662729483`*^9}, {
   3.861776504307125*^9, 3.861776506452546*^9}, {3.861790836878641*^9, 
   3.8617908644265633`*^9}, {3.8617925925866203`*^9, 3.861792592785383*^9}, {
   3.862379440861587*^9, 3.862379443500042*^9}, {3.8623797783272533`*^9, 
   3.8623797966205387`*^9}, {3.862387442127976*^9, 3.862387491859336*^9}, {
   3.862387521964925*^9, 3.8623875968399153`*^9}, {3.862387676068582*^9, 
   3.862387724997177*^9}, {3.862387778668825*^9, 3.862387814871768*^9}, {
   3.862392608579921*^9, 3.862392702735374*^9}, {3.8623927542899446`*^9, 
   3.862392754844028*^9}, {3.8623930192442493`*^9, 3.8623930878603907`*^9}, {
   3.8623933835925827`*^9, 3.862393440583508*^9}, {3.862393685829916*^9, 
   3.862393686072443*^9}, {3.86239386605687*^9, 3.862393867131136*^9}, {
   3.8624496123302317`*^9, 3.8624496182526073`*^9}, {3.862453057781434*^9, 
   3.862453057969841*^9}, {3.862453471268078*^9, 3.862453502072713*^9}, {
   3.862458188771047*^9, 3.8624581891893044`*^9}, {3.862458249486465*^9, 
   3.862458264694969*^9}, {3.862458299168325*^9, 3.862458299262282*^9}, {
   3.862466662430339*^9, 3.8624666775757647`*^9}, {3.86246757539219*^9, 
   3.862467603714926*^9}, {3.862467634053728*^9, 3.862467650807325*^9}, {
   3.862467809177422*^9, 3.862467821456102*^9}, {3.862468469255341*^9, 
   3.862468469701413*^9}, {3.862469771055553*^9, 3.862469783733288*^9}, 
   3.8624701813020782`*^9, {3.8624703511493187`*^9, 3.862470373313109*^9}, 
   3.862471084132111*^9, {3.862471171159935*^9, 3.862471176511478*^9}, {
   3.8624741708231363`*^9, 3.86247420065738*^9}},
 CellLabel->
  "In[8589]:=",ExpressionUUID->"edf8e69e-ce46-4f76-9fa3-79eec149f722"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"\[Eta]", "=", 
   RowBox[{"1", "/", "t0"}]}], ";", 
  RowBox[{"vF", "=", 
   RowBox[{
    FractionBox["3", "2"], "t0", " ", "a"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"\[CapitalSigma]", "=", 
    RowBox[{"SparseArray", "[", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"#", ",", "#"}], "}"}], "\[Rule]", 
        RowBox[{
         RowBox[{"-", " ", "\[ImaginaryI]"}], " ", "\[Eta]"}]}], "&"}], "/@", 
      
      RowBox[{"(", 
       RowBox[{"bPos", "//", "Flatten"}], ")"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ene", "=", 
   RowBox[{"1.1", "t0"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Kp", "=", 
   RowBox[{"{", 
    RowBox[{"0", ",", 
     FractionBox[
      RowBox[{
       RowBox[{"+", "4"}], "\[Pi]"}], 
      RowBox[{"3", 
       SqrtBox["3"], "a"}]], ",", "0"}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Km", "=", 
   RowBox[{"{", 
    RowBox[{"0", ",", 
     FractionBox[
      RowBox[{
       RowBox[{"-", "4"}], "\[Pi]"}], 
      RowBox[{"3", 
       SqrtBox["3"], "a"}]], ",", "0"}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Cp", "=", "0.0"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Cm", "=", "1.0"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"kx", "=", "0"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ky", "=", 
   RowBox[{
    RowBox[{"Abs", "[", "ene", "]"}], "/", "vF"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Phi]", "=", 
   RowBox[{"Arg", "[", 
    RowBox[{
     RowBox[{"\[ImaginaryI]", " ", "kx"}], " ", "+", " ", "ky"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"\[Sigma]E", "=", 
    RowBox[{"Sign", "[", "ene", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"Clear", "[", "\[Chi]", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"\[Chi]", "[", "1", "]"}], "[", 
   RowBox[{"r_", ",", "k_", ",", "\[Sigma]_", ",", "\[Phi]_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"Cm", "*", 
    SuperscriptBox["\[ExponentialE]", 
     RowBox[{"\[ImaginaryI]", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"k", "+", "Km"}], ")"}], ".", "r"}]}]]}], "+", 
   RowBox[{"Cp", "*", 
    SuperscriptBox["\[ExponentialE]", 
     RowBox[{"\[ImaginaryI]", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"k", "+", "Kp"}], ")"}], ".", 
       "r"}]}]]}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"\[Chi]", "[", "2", "]"}], "[", 
   RowBox[{"r_", ",", "k_", ",", "\[Sigma]_", ",", "\[Phi]_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"\[Sigma]", " ", "Cm", " ", 
    SuperscriptBox["\[ExponentialE]", 
     RowBox[{
      RowBox[{"\[ImaginaryI]", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"k", "+", "Km"}], ")"}], ".", "r"}]}], " ", "+", " ", 
      RowBox[{"\[ImaginaryI]", " ", "\[Phi]"}]}]]}], "-", 
   RowBox[{"\[Sigma]", " ", "Cp", " ", 
    SuperscriptBox["\[ExponentialE]", 
     RowBox[{
      RowBox[{"\[ImaginaryI]", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"k", "+", "Kp"}], ")"}], ".", "r"}]}], " ", "-", " ", 
      RowBox[{"\[ImaginaryI]", " ", "\[Phi]"}]}]]}]}]}], "\n", 
 RowBox[{
  RowBox[{"inTuples", "=", 
   RowBox[{"Tuples", "[", 
    RowBox[{"{", 
     RowBox[{"inPos", ",", "inPos"}], "}"}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"\[CapitalSigma]inP", "=", 
   RowBox[{"0", "*", "H"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      RowBox[{"\[CapitalSigma]inP", "[", 
       RowBox[{"[", 
        RowBox[{"Sequence", "@@", "#"}], "]"}], "]"}], "=", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"\[Chi]", "[", 
          RowBox[{"deformedLatt", "[", 
           RowBox[{"[", 
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}], ",", "2"}], "]"}], "]"}], "]"}],
          "[", 
         RowBox[{
          RowBox[{"deformedLatt", "[", 
           RowBox[{"[", 
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}], ",", "1"}], "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"kx", ",", "ky", ",", "0"}], "}"}], ",", "\[Sigma]E", ",", 
          "\[Phi]"}], "]"}], "\[Conjugate]"}], " ", 
       RowBox[{
        RowBox[{"\[Chi]", "[", 
         RowBox[{"deformedLatt", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "2", "]"}], "]"}], ",", "2"}], "]"}], "]"}], "]"}], 
        "[", 
        RowBox[{
         RowBox[{"deformedLatt", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "2", "]"}], "]"}], ",", "1"}], "]"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"kx", ",", "ky", ",", "0"}], "}"}], ",", "\[Sigma]E", ",", 
         "\[Phi]"}], "]"}]}]}], ")"}], "&"}], "/@", "inTuples"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"G", "=", 
   RowBox[{"Inverse", "[", 
    RowBox[{"N", "[", 
     RowBox[{
      RowBox[{"ene", "*", 
       RowBox[{"IdentityMatrix", "[", 
        RowBox[{"Dimensions", "[", "Hdef", "]"}], "]"}]}], "-", "Hdef", "-", 
      "\[CapitalSigma]"}], "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"GP", " ", "=", " ", 
    RowBox[{"G", ".", "\[CapitalSigma]inP", ".", 
     RowBox[{"G", "\[ConjugateTranspose]"}]}]}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"GP", "=", 
     RowBox[{"GP", "/", 
      RowBox[{"Max", "[", 
       RowBox[{"Abs", "[", 
        RowBox[{"Im", "[", 
         RowBox[{"Diagonal", "[", 
          RowBox[{"GP", ",", "1"}], "]"}], "]"}], "]"}], "]"}]}]}], ";"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"nP", " ", "=", " ", 
   RowBox[{"Re", "[", 
    RowBox[{"Diagonal", "[", 
     RowBox[{"(", 
      RowBox[{"GP", "+", 
       RowBox[{"GP", "\[ConjugateTranspose]"}]}], ")"}], "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ppP", " ", "=", " ", 
   FractionBox[
    RowBox[{"Abs", "[", "nP", "]"}], 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{"w", "=", 
         RowBox[{"Max", "[", 
          RowBox[{"Abs", "[", "nP", "]"}], "]"}]}], ")"}], ">", "1*^-8"}], 
      ",", "w", ",", "1"}], "]"}]]}], ";"}]}], "Input",
 CellChangeTimes->{{3.861680428037607*^9, 3.861680465038351*^9}, {
   3.861760302531777*^9, 3.861760306449637*^9}, {3.86176420211625*^9, 
   3.861764207018589*^9}, {3.861764308664955*^9, 3.8617644383564577`*^9}, {
   3.8617645167484407`*^9, 3.8617645232461033`*^9}, {3.861764896338635*^9, 
   3.861764900865672*^9}, {3.861764973927784*^9, 3.861764992299336*^9}, {
   3.861765028642514*^9, 3.861765030225082*^9}, {3.8617669470596533`*^9, 
   3.861767100888239*^9}, {3.861767140959567*^9, 3.8617672996471443`*^9}, {
   3.861767388152668*^9, 3.861767542071639*^9}, {3.86176760404949*^9, 
   3.861767680964488*^9}, {3.86176794491117*^9, 3.8617679696727667`*^9}, 
   3.861768336751824*^9, {3.8617689847541933`*^9, 3.861768985893942*^9}, {
   3.861769099351112*^9, 3.861769099723093*^9}, {3.8617691419251127`*^9, 
   3.861769160032196*^9}, {3.861769241748329*^9, 3.861769242741987*^9}, {
   3.861769397760591*^9, 3.861769516554014*^9}, {3.8617695575803328`*^9, 
   3.861769672139999*^9}, {3.86177007645299*^9, 3.861770111232374*^9}, {
   3.8617702548894873`*^9, 3.861770313416233*^9}, {3.8617705347719383`*^9, 
   3.861770604051373*^9}, {3.861770673966518*^9, 3.861770699670542*^9}, {
   3.861770732354847*^9, 3.861770735666518*^9}, {3.861770767464555*^9, 
   3.861770774031423*^9}, {3.86177080796532*^9, 3.8617708090127897`*^9}, {
   3.86177084858703*^9, 3.861770861895232*^9}, {3.8617709274508*^9, 
   3.861770946244905*^9}, {3.861770989607337*^9, 3.861770992747612*^9}, {
   3.8617710625779963`*^9, 3.861771145849951*^9}, {3.861771226420226*^9, 
   3.8617712868567057`*^9}, {3.8617715109291887`*^9, 3.861771511179449*^9}, {
   3.861775346338788*^9, 3.8617753474595346`*^9}, {3.861775400993595*^9, 
   3.86177540159974*^9}, {3.861775445938592*^9, 3.861775447594882*^9}, {
   3.861775479974389*^9, 3.8617754807662697`*^9}, {3.8617757975920963`*^9, 
   3.861775798528091*^9}, {3.861776152816614*^9, 3.861776153098925*^9}, {
   3.861776197006073*^9, 3.8617761976279182`*^9}, {3.861776250957451*^9, 
   3.861776253695269*^9}, {3.861776300097451*^9, 3.861776301865267*^9}, {
   3.861776381343014*^9, 3.861776381675535*^9}, {3.861776422806561*^9, 
   3.86177642439923*^9}, {3.861776465717349*^9, 3.8617764662729483`*^9}, {
   3.861776504307125*^9, 3.861776506452546*^9}, {3.861790836878641*^9, 
   3.8617908644265633`*^9}, {3.8617925925866203`*^9, 3.861792592785383*^9}, {
   3.862379440861587*^9, 3.862379443500042*^9}, {3.8623797783272533`*^9, 
   3.8623797966205387`*^9}, {3.862387442127976*^9, 3.862387491859336*^9}, {
   3.862387521964925*^9, 3.8623875968399153`*^9}, {3.862387676068582*^9, 
   3.862387724997177*^9}, {3.862387778668825*^9, 3.862387814871768*^9}, {
   3.862392608579921*^9, 3.862392702735374*^9}, {3.8623927542899446`*^9, 
   3.862392754844028*^9}, {3.8623930192442493`*^9, 3.8623930878603907`*^9}, {
   3.8623933835925827`*^9, 3.862393403571138*^9}, {3.862393453579074*^9, 
   3.8623935798990393`*^9}, {3.862393693610911*^9, 3.862393694055997*^9}, {
   3.862393887695878*^9, 3.862393908125898*^9}, {3.862393955788155*^9, 
   3.862393990027814*^9}, {3.86239509688199*^9, 3.862395100390318*^9}, {
   3.862453083994437*^9, 3.8624531379262342`*^9}, 3.8624534559355707`*^9, 
   3.862455680149119*^9, 3.86245610715191*^9, {3.8624580813148813`*^9, 
   3.862458082930019*^9}, {3.862458121514139*^9, 3.8624581614391937`*^9}, {
   3.862458236125293*^9, 3.862458236362718*^9}, {3.862458276161203*^9, 
   3.862458291827161*^9}, {3.862458426368164*^9, 3.862458433444456*^9}, {
   3.862458469479639*^9, 3.862458503345791*^9}, {3.862468497792245*^9, 
   3.8624685156362658`*^9}, {3.862468792536182*^9, 3.862468796018175*^9}, {
   3.862468850827857*^9, 3.862468854023149*^9}, {3.862468895087612*^9, 
   3.862468919989706*^9}, {3.862469758766272*^9, 3.8624697589764767`*^9}, 
   3.862470160741639*^9, {3.862471020119336*^9, 3.862471039163999*^9}, {
   3.862471072507613*^9, 3.862471073552341*^9}, 3.862471188601616*^9, {
   3.86247321940132*^9, 3.862473282967268*^9}, {3.8624734489154787`*^9, 
   3.862473449254116*^9}, {3.86247401027567*^9, 3.862474012395506*^9}, {
   3.862474043873917*^9, 3.862474047173534*^9}, {3.862474100026257*^9, 
   3.862474100580632*^9}, 
   3.862475087564579*^9},ExpressionUUID->"456c6d6d-a564-49e3-97fb-\
014a821c98b9"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"current", "=", 
   RowBox[{"Graphics3D", "[", 
    RowBox[{"{", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Blend", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"White", ",", "Red"}], "}"}], ",", 
             SuperscriptBox[
              RowBox[{"#", "[", 
               RowBox[{"[", "1", "]"}], "]"}], 
              RowBox[{"(", 
               RowBox[{"1", "/", "2"}], ")"}]]}], "]"}], ",", 
           RowBox[{"Sphere", "[", 
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "2", "]"}], "]"}], ",", "ss"}], "]"}]}], "}"}], 
         "&"}], "/@", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"ppP", ",", 
            RowBox[{"deformedLatt", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", "1"}], "]"}], "]"}]}], "}"}], 
          "\[Transpose]"}], ")"}]}], ","}], "*)"}], 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Blend", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"White", ",", "Red"}], "}"}], ",", 
            RowBox[{"Abs", "[", 
             RowBox[{"Im", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Hdef", "[", 
                 RowBox[{"[", 
                  RowBox[{"Sequence", "@@", "#"}], "]"}], "]"}], 
                "\[Conjugate]"}], "*", 
               RowBox[{"GP", "[", 
                RowBox[{"[", 
                 RowBox[{"Sequence", "@@", "#"}], "]"}], "]"}]}], "]"}], 
             "]"}]}], "]"}], ",", 
          RowBox[{"CapForm", "[", "\"\<Butt\>\"", "]"}], ",", 
          RowBox[{"Tube", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{
               RowBox[{"deformedLatt", "[", 
                RowBox[{"[", 
                 RowBox[{"All", ",", "1"}], "]"}], "]"}], "[", 
               RowBox[{"[", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], ",", 
              RowBox[{
               RowBox[{"deformedLatt", "[", 
                RowBox[{"[", 
                 RowBox[{"All", ",", "1"}], "]"}], "]"}], "[", 
               RowBox[{"[", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}]}], "}"}], ",", 
            "ts"}], "]"}]}], "}"}], "&"}], "/@", 
       RowBox[{"neighbors", "[", 
        RowBox[{"[", "2", "]"}], "]"}]}], "}"}], "}"}], "]"}]}], 
  ";"}], "\n", 
 RowBox[{"Show", "[", 
  RowBox[{"deformedNodesPlot", ",", "deformedNNPlot", ",", "current", ",", 
   RowBox[{"ViewPoint", "\[Rule]", "Above"}], ",", 
   RowBox[{"Boxed", "\[Rule]", "False"}], ",", 
   RowBox[{"Background", "\[Rule]", "Black"}]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"Show", "[", 
  RowBox[{"deformedNodesPlot", ",", "deformedNNPlot", ",", "current", ",", 
   RowBox[{"ViewPoint", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{"Right", ",", "Above"}], "}"}]}], ",", 
   RowBox[{"Boxed", "\[Rule]", "False"}], ",", 
   RowBox[{"Background", "\[Rule]", "Black"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.861680428037607*^9, 3.861680465038351*^9}, {
   3.861760302531777*^9, 3.861760306449637*^9}, {3.86176420211625*^9, 
   3.861764207018589*^9}, {3.861764308664955*^9, 3.8617644383564577`*^9}, {
   3.8617645167484407`*^9, 3.8617645232461033`*^9}, {3.861764896338635*^9, 
   3.861764900865672*^9}, {3.861764973927784*^9, 3.861764992299336*^9}, {
   3.861765028642514*^9, 3.861765030225082*^9}, {3.8617669470596533`*^9, 
   3.861767100888239*^9}, {3.861767140959567*^9, 3.8617672996471443`*^9}, {
   3.861767388152668*^9, 3.861767542071639*^9}, {3.86176760404949*^9, 
   3.861767680964488*^9}, {3.86176794491117*^9, 3.8617679696727667`*^9}, 
   3.861768336751824*^9, {3.8617689847541933`*^9, 3.861768985893942*^9}, {
   3.861769099351112*^9, 3.861769099723093*^9}, {3.8617691419251127`*^9, 
   3.861769160032196*^9}, {3.861769241748329*^9, 3.861769242741987*^9}, {
   3.861769397760591*^9, 3.861769516554014*^9}, {3.8617695575803328`*^9, 
   3.861769672139999*^9}, {3.86177007645299*^9, 3.861770111232374*^9}, {
   3.8617702548894873`*^9, 3.861770313416233*^9}, {3.8617705347719383`*^9, 
   3.861770604051373*^9}, {3.861770673966518*^9, 3.861770699670542*^9}, {
   3.861770732354847*^9, 3.861770735666518*^9}, {3.861770767464555*^9, 
   3.861770774031423*^9}, {3.86177080796532*^9, 3.8617708090127897`*^9}, {
   3.86177084858703*^9, 3.861770861895232*^9}, {3.8617709274508*^9, 
   3.861770946244905*^9}, {3.861770989607337*^9, 3.861770992747612*^9}, {
   3.8617710625779963`*^9, 3.861771145849951*^9}, {3.861771226420226*^9, 
   3.8617712868567057`*^9}, {3.8617715109291887`*^9, 3.861771511179449*^9}, {
   3.861775346338788*^9, 3.8617753474595346`*^9}, {3.861775400993595*^9, 
   3.86177540159974*^9}, {3.861775445938592*^9, 3.861775447594882*^9}, {
   3.861775479974389*^9, 3.8617754807662697`*^9}, {3.8617757975920963`*^9, 
   3.861775798528091*^9}, {3.861776152816614*^9, 3.861776153098925*^9}, {
   3.861776197006073*^9, 3.8617761976279182`*^9}, {3.861776250957451*^9, 
   3.861776253695269*^9}, {3.861776300097451*^9, 3.861776301865267*^9}, {
   3.861776381343014*^9, 3.861776381675535*^9}, {3.861776422806561*^9, 
   3.86177642439923*^9}, {3.861776465717349*^9, 3.8617764662729483`*^9}, {
   3.861776504307125*^9, 3.861776506452546*^9}, {3.861790836878641*^9, 
   3.8617908644265633`*^9}, {3.8617925925866203`*^9, 3.861792592785383*^9}, {
   3.862379440861587*^9, 3.862379443500042*^9}, {3.8623797783272533`*^9, 
   3.8623797966205387`*^9}, {3.862387442127976*^9, 3.862387491859336*^9}, {
   3.862387521964925*^9, 3.8623875968399153`*^9}, {3.862387676068582*^9, 
   3.862387724997177*^9}, {3.862387778668825*^9, 3.862387814871768*^9}, {
   3.862392608579921*^9, 3.862392702735374*^9}, {3.8623927542899446`*^9, 
   3.862392754844028*^9}, {3.8623930192442493`*^9, 3.8623930878603907`*^9}, {
   3.8623933835925827`*^9, 3.862393403571138*^9}, {3.862393453579074*^9, 
   3.8623935798990393`*^9}, {3.862393693610911*^9, 3.862393694055997*^9}, {
   3.862393887695878*^9, 3.862393908125898*^9}, {3.862393955788155*^9, 
   3.862393990027814*^9}, {3.86239509688199*^9, 3.862395100390318*^9}, {
   3.862453083994437*^9, 3.8624531379262342`*^9}, 3.8624534559355707`*^9, 
   3.862455680149119*^9, 3.86245610715191*^9, {3.8624580813148813`*^9, 
   3.862458082930019*^9}, {3.862458121514139*^9, 3.8624581614391937`*^9}, {
   3.862458236125293*^9, 3.862458236362718*^9}, {3.862458276161203*^9, 
   3.862458291827161*^9}, {3.862458426368164*^9, 3.862458433444456*^9}, {
   3.862458469479639*^9, 3.862458503345791*^9}, {3.862468497792245*^9, 
   3.8624685156362658`*^9}, {3.862468792536182*^9, 3.862468796018175*^9}, {
   3.862468850827857*^9, 3.862468854023149*^9}, {3.862468895087612*^9, 
   3.862468919989706*^9}, {3.862469758766272*^9, 3.8624697589764767`*^9}, 
   3.862470160741639*^9, {3.862471020119336*^9, 3.862471039163999*^9}, {
   3.862471072507613*^9, 3.862471073552341*^9}, 3.862471188601616*^9, {
   3.86247321940132*^9, 3.862473282967268*^9}, {3.8624734489154787`*^9, 
   3.862473449254116*^9}, {3.86247401027567*^9, 3.862474012395506*^9}, {
   3.862474043873917*^9, 3.862474047173534*^9}, {3.862474100026257*^9, 
   3.862474100580632*^9}, {3.862475087564579*^9, 3.8624750944044523`*^9}, {
   3.862475129267558*^9, 3.862475135091138*^9}},
 CellLabel->
  "In[8623]:=",ExpressionUUID->"527423ae-974b-4f57-ad28-31bf3d1ccbd0"]
}, Open  ]]
},
WindowSize->{1440, 847},
WindowMargins->{{0, Automatic}, {Automatic, 0}},
TaggingRules->{
 "WelcomeScreenSettings" -> {"FEStarting" -> False}, "TryRealOnly" -> False},
Magnification:>1.5 Inherited,
FrontEndVersion->"12.2 for Mac OS X x86 (64-bit) (December 12, 2020)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"823a0875-ddeb-469f-954a-657674b48cfc"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 267, 4, 101, "Section",ExpressionUUID->"3f90875f-d181-4cb6-a0d4-c5d25785af38"],
Cell[850, 28, 24836, 628, 2098, "Input",ExpressionUUID->"ee34dac1-baef-424f-a299-22c8d32aaae5"]
}, Open  ]],
Cell[CellGroupData[{
Cell[25723, 661, 260, 4, 101, "Section",ExpressionUUID->"93a277f6-7bae-49be-b605-d4a7db75a702"],
Cell[25986, 667, 17661, 383, 870, "Input",ExpressionUUID->"0333928c-7cf8-43be-9ac8-660f7cc83d75"],
Cell[43650, 1052, 5473, 139, 769, "Input",ExpressionUUID->"580008bd-3cb9-4f3b-9967-201801c377f9"],
Cell[49126, 1193, 5645, 140, 580, "Input",ExpressionUUID->"46666165-96dd-4ccb-ad7c-b5e1d5f8f8a8"],
Cell[54774, 1335, 2068, 60, 109, "Input",ExpressionUUID->"cfc3b200-9be3-4bc9-b1e7-8bbf0607a9d5"],
Cell[56845, 1397, 2581, 59, 171, "Input",ExpressionUUID->"0e2a08ad-3c81-4ea4-9ce0-82c53adf1a13"],
Cell[59429, 1458, 2359, 65, 258, "Input",ExpressionUUID->"b6c6b485-3b8f-4c80-b030-766c55f7a1f8"],
Cell[61791, 1525, 1190, 36, 109, "Input",ExpressionUUID->"0f73ff5a-ff69-4d34-99ba-d7e3e1e267e3"],
Cell[62984, 1563, 9053, 204, 828, "Input",ExpressionUUID->"6424a4b9-5678-4b48-a680-8116c3e4226f"],
Cell[72040, 1769, 8623, 190, 396, "Input",ExpressionUUID->"edf8e69e-ce46-4f76-9fa3-79eec149f722"],
Cell[80666, 1961, 10711, 261, 921, "Input",ExpressionUUID->"456c6d6d-a564-49e3-97fb-014a821c98b9"],
Cell[91380, 2224, 7581, 148, 208, "Input",ExpressionUUID->"527423ae-974b-4f57-ad28-31bf3d1ccbd0"]
}, Open  ]]
}
]
*)

